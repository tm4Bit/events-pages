!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(e="undefined"!=typeof globalThis?globalThis:e||self).Dexie=n()}(this,function(){"use strict";/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.
    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.
    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */ var e,n,t,r,i=function(e,n){return(i=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])})(e,n)},o=function(){return(o=Object.assign||function e(n){for(var t,r=1,i=arguments.length;r<i;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(n[o]=t[o]);return n}).apply(this,arguments)};function a(e,n,t){if(t||2===arguments.length)for(var r,i=0,o=n.length;i<o;i++)!r&&i in n||(r||(r=Array.prototype.slice.call(n,0,i)),r[i]=n[i]);return e.concat(r||Array.prototype.slice.call(n))}var u="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:global,s=Object.keys,c=Array.isArray;function l(e,n){return"object"!=typeof n||s(n).forEach(function(t){e[t]=n[t]}),e}"undefined"==typeof Promise||u.Promise||(u.Promise=Promise);var f=Object.getPrototypeOf,h={}.hasOwnProperty;function d(e,n){return h.call(e,n)}function p(e,n){"function"==typeof n&&(n=n(f(e))),("undefined"==typeof Reflect?s:Reflect.ownKeys)(n).forEach(function(t){v(e,t,n[t])})}var y=Object.defineProperty;function v(e,n,t,r){y(e,n,l(t&&d(t,"get")&&"function"==typeof t.get?{get:t.get,set:t.set,configurable:!0}:{value:t,configurable:!0,writable:!0},r))}function m(e){return{from:function(n){return e.prototype=Object.create(n.prototype),v(e.prototype,"constructor",e),{extend:p.bind(null,e.prototype)}}}}var b=Object.getOwnPropertyDescriptor,g=[].slice;function $(e,n,t){return g.call(e,n,t)}function w(e,n){return n(e)}function _(e){if(!e)throw Error("Assertion Failed")}function x(e){u.setImmediate?setImmediate(e):setTimeout(e,0)}function k(e,n){if("string"==typeof n&&d(e,n))return e[n];if(!n)return e;if("string"!=typeof n){for(var t=[],r=0,i=n.length;r<i;++r){var o=k(e,n[r]);t.push(o)}return t}var a=n.indexOf(".");if(-1!==a){var u=e[n.substr(0,a)];return null==u?void 0:k(u,n.substr(a+1))}}function K(e,n,t){if(e&&void 0!==n&&!("isFrozen"in Object&&Object.isFrozen(e))){if("string"!=typeof n&&"length"in n){_("string"!=typeof t&&"length"in t);for(var r=0,i=n.length;r<i;++r)K(e,n[r],t[r])}else{var o=n.indexOf(".");if(-1!==o){var a=n.substr(0,o),u=n.substr(o+1);if(""===u)void 0===t?c(e)&&!isNaN(parseInt(a))?e.splice(a,1):delete e[a]:e[a]=t;else{var s=e[a];s&&d(e,a)||(s=e[a]={}),K(s,u,t)}}else void 0===t?c(e)&&!isNaN(parseInt(n))?e.splice(n,1):delete e[n]:e[n]=t}}}function P(e){var n={};for(var t in e)d(e,t)&&(n[t]=e[t]);return n}var O=[].concat;function S(e){return O.apply([],e)}var C="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(S([8,16,32,64].map(function(e){return["Int","Uint","Float"].map(function(n){return n+e+"Array"})}))).filter(function(e){return u[e]}),E=new Set(C.map(function(e){return u[e]})),D=null;function A(e){D=new WeakMap;var n=function e(n){if(!n||"object"!=typeof n)return n;var t=D.get(n);if(t)return t;if(c(n)){t=[],D.set(n,t);for(var r=0,i=n.length;r<i;++r)t.push(e(n[r]))}else if(E.has(n.constructor))t=n;else{var o=f(n);for(var a in t=o===Object.prototype?{}:Object.create(o),D.set(n,t),n)d(n,a)&&(t[a]=e(n[a]))}return t}(e);return D=null,n}var q={}.toString;function I(e){return q.call(e).slice(8,-1)}var B="undefined"!=typeof Symbol?Symbol.iterator:"@@iterator",R="symbol"==typeof B?function(e){var n;return null!=e&&(n=e[B])&&n.apply(e)}:function(){return null};function j(e,n){var t=e.indexOf(n);return t>=0&&e.splice(t,1),t>=0}var T={};function F(e){var n,t,r,i;if(1===arguments.length){if(c(e))return e.slice();if(this===T&&"string"==typeof e)return[e];if(i=R(e)){for(t=[];!(r=i.next()).done;)t.push(r.value);return t}if(null==e)return[e];if("number"==typeof(n=e.length)){for(t=Array(n);n--;)t[n]=e[n];return t}return[e]}for(n=arguments.length,t=Array(n);n--;)t[n]=arguments[n];return t}var N="undefined"!=typeof Symbol?function(e){return"AsyncFunction"===e[Symbol.toStringTag]}:function(){return!1},M=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],L=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(M),U={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function V(e,n){this.name=e,this.message=n}function z(e,n){return e+". Errors: "+Object.keys(n).map(function(e){return n[e].toString()}).filter(function(e,n,t){return t.indexOf(e)===n}).join("\n")}function Y(e,n,t,r){this.failures=n,this.failedKeys=r,this.successCount=t,this.message=z(e,n)}function W(e,n){this.name="BulkError",this.failures=Object.keys(n).map(function(e){return n[e]}),this.failuresByPos=n,this.message=z(e,this.failures)}m(V).from(Error).extend({toString:function(){return this.name+": "+this.message}}),m(Y).from(V),m(W).from(V);var Q=L.reduce(function(e,n){return e[n]=n+"Error",e},{}),G=V,X=L.reduce(function(e,n){var t=n+"Error";function r(e,r){this.name=t,e?"string"==typeof e?(this.message="".concat(e).concat(r?"\n "+r:""),this.inner=r||null):"object"==typeof e&&(this.message="".concat(e.name," ").concat(e.message),this.inner=e):(this.message=U[n]||t,this.inner=null)}return m(r).from(G),e[n]=r,e},{});X.Syntax=SyntaxError,X.Type=TypeError,X.Range=RangeError;var H=M.reduce(function(e,n){return e[n+"Error"]=X[n],e},{}),J=L.reduce(function(e,n){return -1===["Syntax","Type","Range"].indexOf(n)&&(e[n+"Error"]=X[n]),e},{});function Z(){}function ee(e){return e}function en(e,n){return null==e||e===ee?n:function(t){return n(e(t))}}function et(e,n){return function(){e.apply(this,arguments),n.apply(this,arguments)}}function er(e,n){return e===Z?n:function(){var t=e.apply(this,arguments);void 0!==t&&(arguments[0]=t);var r=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var o=n.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?et(r,this.onsuccess):r),i&&(this.onerror=this.onerror?et(i,this.onerror):i),void 0!==o?o:t}}function ei(e,n){return e===Z?n:function(){e.apply(this,arguments);var t=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,n.apply(this,arguments),t&&(this.onsuccess=this.onsuccess?et(t,this.onsuccess):t),r&&(this.onerror=this.onerror?et(r,this.onerror):r)}}function eo(e,n){return e===Z?n:function(t){var r=e.apply(this,arguments);l(t,r);var i=this.onsuccess,o=this.onerror;this.onsuccess=null,this.onerror=null;var a=n.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?et(i,this.onsuccess):i),o&&(this.onerror=this.onerror?et(o,this.onerror):o),void 0===r?void 0===a?void 0:a:l(r,a)}}function ea(e,n){return e===Z?n:function(){return!1!==n.apply(this,arguments)&&e.apply(this,arguments)}}function eu(e,n){return e===Z?n:function(){var t=e.apply(this,arguments);if(t&&"function"==typeof t.then){for(var r=this,i=arguments.length,o=Array(i);i--;)o[i]=arguments[i];return t.then(function(){return n.apply(r,o)})}return n.apply(this,arguments)}}J.ModifyError=Y,J.DexieError=V,J.BulkError=W;var es="undefined"!=typeof location&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function ec(e,n){es=e}var el={},ef="undefined"==typeof Promise?[]:function(){var e=Promise.resolve();if("undefined"==typeof crypto||!crypto.subtle)return[e,f(e),e];var n=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[n,f(n),e]}(),eh=ef[0],ed=ef[1],ep=ef[2],ey=ed&&ed.then,ev=eh&&eh.constructor,em=!!ep,eb=function(e,n){eK.push([e,n]),e$&&(queueMicrotask(eB),e$=!1)},eg=!0,e$=!0,ew=[],e8=[],e_=ee,ex={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:Z,pgp:!1,env:{},finalize:Z},ek=ex,eK=[],eP=0,eO=[];function eS(e){if("object"!=typeof this)throw TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var n=this._PSD=ek;if("function"!=typeof e){if(e!==el)throw TypeError("Not a function");this._state=arguments[1],this._value=arguments[2],!1===this._state&&eD(this,this._value);return}this._state=null,this._value=null,++n.ref,function e(n,t){try{t(function(t){if(null===n._state){if(t===n)throw TypeError("A promise cannot be resolved with itself.");var r=n._lib&&eR();t&&"function"==typeof t.then?e(n,function(e,n){t instanceof eS?t._then(e,n):t.then(e,n)}):(n._state=!0,n._value=t,eA(n)),r&&ej()}},eD.bind(null,n))}catch(r){eD(n,r)}}(this,e)}var eC={get:function(){var e=ek,n=ez;function t(t,r){var i=this,o=!e.global&&(e!==ek||n!==ez),a=o&&!eW(),u=new eS(function(n,u){eq(i,new eE(eX(t,e,o,a),eX(r,e,o,a),n,u,e))});return this._consoleTask&&(u._consoleTask=this._consoleTask),u}return t.prototype=el,t},set:function(e){v(this,"then",e&&e.prototype===el?eC:{get:function(){return e},set:eC.set})}};function eE(e,n,t,r,i){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof n?n:null,this.resolve=t,this.reject=r,this.psd=i}function eD(e,n){if(e8.push(n),null===e._state){var t,r=e._lib&&eR();n=e_(n),e._state=!1,e._value=n,t=e,ew.some(function(e){return e._value===t._value})||ew.push(t),eA(e),r&&ej()}}function eA(e){var n=e._listeners;e._listeners=[];for(var t=0,r=n.length;t<r;++t)eq(e,n[t]);var i=e._PSD;--i.ref||i.finalize(),0===eP&&(++eP,eb(function(){0==--eP&&eT()},[]))}function eq(e,n){if(null===e._state){e._listeners.push(n);return}var t=e._state?n.onFulfilled:n.onRejected;if(null===t)return(e._state?n.resolve:n.reject)(e._value);++n.psd.ref,++eP,eb(eI,[t,e,n])}function eI(e,n,t){try{var r,i=n._value;!n._state&&e8.length&&(e8=[]),r=es&&n._consoleTask?n._consoleTask.run(function(){return e(i)}):e(i),n._state||-1!==e8.indexOf(i)||function e(n){for(var t=ew.length;t;)if(ew[--t]._value===n._value){ew.splice(t,1);return}}(n),t.resolve(r)}catch(o){t.reject(o)}finally{0==--eP&&eT(),--t.psd.ref||t.psd.finalize()}}function eB(){e4(ex,function(){eR()&&ej()})}function eR(){var e=eg;return eg=!1,e$=!1,e}function ej(){var e,n,t;do for(;eK.length>0;)for(n=0,e=eK,eK=[],t=e.length;n<t;++n){var r=e[n];r[0].apply(null,r[1])}while(eK.length>0);eg=!0,e$=!0}function eT(){var e=ew;ew=[],e.forEach(function(e){e._PSD.onunhandled.call(null,e._value,e)});for(var n=eO.slice(0),t=n.length;t;)n[--t]()}function eF(e){return new eS(el,!1,e)}function eN(e,n){var t=ek;return function(){var r=eR(),i=ek;try{return eG(t,!0),e.apply(this,arguments)}catch(o){n&&n(o)}finally{eG(i,!1),r&&ej()}}}p(eS.prototype,{then:eC,_then:function(e,n){eq(this,new eE(null,null,e,n,ek))},catch:function(e){if(1===arguments.length)return this.then(null,e);var n=arguments[0],t=arguments[1];return"function"==typeof n?this.then(null,function(e){return e instanceof n?t(e):eF(e)}):this.then(null,function(e){return e&&e.name===n?t(e):eF(e)})},finally:function(e){return this.then(function(n){return eS.resolve(e()).then(function(){return n})},function(n){return eS.resolve(e()).then(function(){return eF(n)})})},timeout:function(e,n){var t=this;return e<1/0?new eS(function(r,i){var o=setTimeout(function(){return i(new X.Timeout(n))},e);t.then(r,i).finally(clearTimeout.bind(null,o))}):this}}),"undefined"!=typeof Symbol&&Symbol.toStringTag&&v(eS.prototype,Symbol.toStringTag,"Dexie.Promise"),ex.env=e2(),p(eS,{all:function(){var e=F.apply(null,arguments).map(e9);return new eS(function(n,t){0===e.length&&n([]);var r=e.length;e.forEach(function(i,o){return eS.resolve(i).then(function(t){e[o]=t,--r||n(e)},t)})})},resolve:function(e){return e instanceof eS?e:e&&"function"==typeof e.then?new eS(function(n,t){e.then(n,t)}):new eS(el,!0,e)},reject:eF,race:function(){var e=F.apply(null,arguments).map(e9);return new eS(function(n,t){e.map(function(e){return eS.resolve(e).then(n,t)})})},PSD:{get:function(){return ek},set:function(e){return ek=e}},totalEchoes:{get:function(){return ez}},newPSD:e1,usePSD:e4,scheduler:{get:function(){return eb},set:function(e){eb=e}},rejectionMapper:{get:function(){return e_},set:function(e){e_=e}},follow:function(e,n){return new eS(function(t,r){return e1(function(n,t){var r=ek;r.unhandleds=[],r.onunhandled=t,r.finalize=et(function(){var e=this;(function e(n){function t(){n(),eO.splice(eO.indexOf(t),1)}eO.push(t),++eP,eb(function(){0==--eP&&eT()},[])})(function(){0===e.unhandleds.length?n():t(e.unhandleds[0])})},r.finalize),e()},n,t,r)})}}),ev&&(ev.allSettled&&v(eS,"allSettled",function(){var e=F.apply(null,arguments).map(e9);return new eS(function(n){0===e.length&&n([]);var t=e.length,r=Array(t);e.forEach(function(e,i){return eS.resolve(e).then(function(e){return r[i]={status:"fulfilled",value:e}},function(e){return r[i]={status:"rejected",reason:e}}).then(function(){return--t||n(r)})})})}),ev.any&&"undefined"!=typeof AggregateError&&v(eS,"any",function(){var e=F.apply(null,arguments).map(e9);return new eS(function(n,t){0===e.length&&t(AggregateError([]));var r=e.length,i=Array(r);e.forEach(function(e,o){return eS.resolve(e).then(function(e){return n(e)},function(e){i[o]=e,--r||t(AggregateError(i))})})})}),ev.withResolvers&&(eS.withResolvers=ev.withResolvers));var eM={awaits:0,echoes:0,id:0},eL=0,eU=[],eV=0,ez=0,e0=0;function e1(e,n,t,r){var i=ek,o=Object.create(i);o.parent=i,o.ref=0,o.global=!1,o.id=++e0,ex.env,o.env=em?{Promise:eS,PromiseProp:{value:eS,configurable:!0,writable:!0},all:eS.all,race:eS.race,allSettled:eS.allSettled,any:eS.any,resolve:eS.resolve,reject:eS.reject}:{},n&&l(o,n),++i.ref,o.finalize=function(){--this.parent.ref||this.parent.finalize()};var a=e4(o,e,t,r);return 0===o.ref&&o.finalize(),a}function eY(){return eM.id||(eM.id=++eL),++eM.awaits,eM.echoes+=100,eM.id}function eW(){return!!eM.awaits&&(0==--eM.awaits&&(eM.id=0),eM.echoes=100*eM.awaits,!0)}function e9(e){return eM.echoes&&e&&e.constructor===ev?(eY(),e.then(function(e){return eW(),e},function(e){return eW(),e7(e)})):e}function e6(e){++ez,eM.echoes&&0!=--eM.echoes||(eM.echoes=eM.awaits=eM.id=0),eU.push(ek),eG(e,!0)}function eQ(){var e=eU[eU.length-1];eU.pop(),eG(e,!1)}function eG(e,n){var t=ek;if((n?!eM.echoes||eV++&&e===ek:!eV||--eV&&e===ek)||queueMicrotask(n?e6.bind(null,e):eQ),e!==ek&&(ek=e,t===ex&&(ex.env=e2()),em)){var r=ex.env.Promise,i=e.env;(t.global||e.global)&&(Object.defineProperty(u,"Promise",i.PromiseProp),r.all=i.all,r.race=i.race,r.resolve=i.resolve,r.reject=i.reject,i.allSettled&&(r.allSettled=i.allSettled),i.any&&(r.any=i.any))}}function e2(){var e=u.Promise;return em?{Promise:e,PromiseProp:Object.getOwnPropertyDescriptor(u,"Promise"),all:e.all,race:e.race,allSettled:e.allSettled,any:e.any,resolve:e.resolve,reject:e.reject}:{}}function e4(e,n,t,r,i){var o=ek;try{return eG(e,!0),n(t,r,i)}finally{eG(o,!1)}}function eX(e,n,t,r){return"function"!=typeof e?e:function(){var i=ek;t&&eY(),eG(n,!0);try{return e.apply(this,arguments)}finally{eG(i,!1),r&&queueMicrotask(eW)}}}function eH(e){Promise===ev&&0===eM.echoes?0===eV?e():enqueueNativeMicroTask(e):setTimeout(e,0)}-1===(""+ey).indexOf("[native code]")&&(eY=eW=Z);var e7=eS.reject,e3="4.0.11",e5=-1/0,eJ="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",eZ="String expected.",ne=[],nn="__dbnames",nt="readonly",nr="readwrite";function ni(e,n){return e?n?function(){return e.apply(this,arguments)&&n.apply(this,arguments)}:e:n}var no={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function na(e){return"string"!=typeof e||/\./.test(e)?function(e){return e}:function(n){return void 0===n[e]&&e in n&&delete(n=A(n))[e],n}}function nu(){throw X.Type()}function ns(e,n){try{var t=nc(e),r=nc(n);if(t!==r){if("Array"===t)return 1;if("Array"===r)return -1;if("binary"===t)return 1;if("binary"===r)return -1;if("string"===t)return 1;if("string"===r)return -1;if("Date"===t)return 1;if("Date"!==r)return NaN;return -1}switch(t){case"number":case"Date":case"string":return e>n?1:e<n?-1:0;case"binary":return function e(n,t){for(var r=n.length,i=t.length,o=r<i?r:i,a=0;a<o;++a)if(n[a]!==t[a])return n[a]<t[a]?-1:1;return r===i?0:r<i?-1:1}(nl(e),nl(n));case"Array":return function e(n,t){for(var r=n.length,i=t.length,o=r<i?r:i,a=0;a<o;++a){var u=ns(n[a],t[a]);if(0!==u)return u}return r===i?0:r<i?-1:1}(e,n)}}catch(i){}return NaN}function nc(e){var n=typeof e;if("object"!==n)return n;if(ArrayBuffer.isView(e))return"binary";var t=I(e);return"ArrayBuffer"===t?"binary":t}function nl(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e)}var nf=function(){function e(){}return e.prototype._trans=function(e,n,t){var r=this._tx||ek.trans,i=this.name,o=es&&"undefined"!=typeof console&&console.createTask&&console.createTask("Dexie: ".concat("readonly"===e?"read":"write"," ").concat(this.name));function a(e,t,r){if(!r.schema[i])throw new X.NotFound("Table "+i+" not part of transaction");return n(r.idbtrans,r)}var u=eR();try{var s=r&&r.db._novip===this.db._novip?r===ek.trans?r._promise(e,a,t):e1(function(){return r._promise(e,a,t)},{trans:r,transless:ek.transless||ek}):function e(n,t,r,i){if(n.idbdb&&(n._state.openComplete||ek.letThrough||n._vip)){var o=n._createTransaction(t,r,n._dbSchema);try{o.create(),n._state.PR1398_maxLoop=3}catch(a){if(a.name===Q.InvalidState&&n.isOpen()&&--n._state.PR1398_maxLoop>0)return console.warn("Dexie: Need to reopen db"),n.close({disableAutoOpen:!1}),n.open().then(function(){return e(n,t,r,i)});return e7(a)}return o._promise(t,function(e,n){return e1(function(){return ek.trans=o,i(e,n,o)})}).then(function(e){if("readwrite"===t)try{o.idbtrans.commit()}catch(n){}return"readonly"===t?e:o._completion.then(function(){return e})})}if(n._state.openComplete)return e7(new X.DatabaseClosed(n._state.dbOpenError));if(!n._state.isBeingOpened){if(!n._state.autoOpen)return e7(new X.DatabaseClosed);n.open().catch(Z)}return n._state.dbReadyPromise.then(function(){return e(n,t,r,i)})}(this.db,e,[this.name],a);return o&&(s._consoleTask=o,s=s.catch(function(e){return console.trace(e),e7(e)})),s}finally{u&&ej()}},e.prototype.get=function(e,n){var t=this;return e&&e.constructor===Object?this.where(e).first(n):null==e?e7(new X.Type("Invalid argument to Table.get()")):this._trans("readonly",function(n){return t.core.get({trans:n,key:e}).then(function(e){return t.hook.reading.fire(e)})}).then(n)},e.prototype.where=function(e){if("string"==typeof e)return new this.db.WhereClause(this,e);if(c(e))return new this.db.WhereClause(this,"[".concat(e.join("+"),"]"));var n=s(e);if(1===n.length)return this.where(n[0]).equals(e[n[0]]);var t=this.schema.indexes.concat(this.schema.primKey).filter(function(e){if(e.compound&&n.every(function(n){return e.keyPath.indexOf(n)>=0})){for(var t=0;t<n.length;++t)if(-1===n.indexOf(e.keyPath[t]))return!1;return!0}return!1}).sort(function(e,n){return e.keyPath.length-n.keyPath.length})[0];if(t&&"￿"!==this.db._maxKey){var r=t.keyPath.slice(0,n.length);return this.where(r).equals(r.map(function(n){return e[n]}))}!t&&es&&console.warn("The query ".concat(JSON.stringify(e)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(n.join("+"),"]"));var i=this.schema.idxByName;function o(e,n){return 0===ns(e,n)}var a=n.reduce(function(n,t){var r=n[0],a=n[1],u=i[t],s=e[t];return[r||u,r||!u?ni(a,u&&u.multi?function(e){var n=k(e,t);return c(n)&&n.some(function(e){return o(s,e)})}:function(e){return o(s,k(e,t))}):a]},[null,null]),u=a[0],l=a[1];return u?this.where(u.name).equals(e[u.keyPath]).filter(l):t?this.filter(l):this.where(n).equals("")},e.prototype.filter=function(e){return this.toCollection().and(e)},e.prototype.count=function(e){return this.toCollection().count(e)},e.prototype.offset=function(e){return this.toCollection().offset(e)},e.prototype.limit=function(e){return this.toCollection().limit(e)},e.prototype.each=function(e){return this.toCollection().each(e)},e.prototype.toArray=function(e){return this.toCollection().toArray(e)},e.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},e.prototype.orderBy=function(e){return new this.db.Collection(new this.db.WhereClause(this,c(e)?"[".concat(e.join("+"),"]"):e))},e.prototype.reverse=function(){return this.toCollection().reverse()},e.prototype.mapToClass=function(e){var n=this.db,t=this.name;this.schema.mappedClass=e,e.prototype instanceof nu&&(e=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return function e(n,t){if("function"!=typeof t&&null!==t)throw TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=n}i(n,t),n.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}(r,e),Object.defineProperty(r.prototype,"db",{get:function(){return n},enumerable:!1,configurable:!0}),r.prototype.table=function(){return t},r}(e));for(var r=new Set,o=e.prototype;o;o=f(o))Object.getOwnPropertyNames(o).forEach(function(e){return r.add(e)});var a=function(n){if(!n)return n;var t=Object.create(e.prototype);for(var i in n)if(!r.has(i))try{t[i]=n[i]}catch(o){}return t};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=a,this.hook("reading",a),e},e.prototype.defineClass=function(){return this.mapToClass(function e(n){l(this,n)})},e.prototype.add=function(e,n){var t=this,r=this.schema.primKey,i=r.auto,o=r.keyPath,a=e;return o&&i&&(a=na(o)(e)),this._trans("readwrite",function(e){return t.core.mutate({trans:e,type:"add",keys:null!=n?[n]:null,values:[a]})}).then(function(e){return e.numFailures?eS.reject(e.failures[0]):e.lastResult}).then(function(n){if(o)try{K(e,o,n)}catch(t){}return n})},e.prototype.update=function(e,n){if("object"!=typeof e||c(e))return this.where(":id").equals(e).modify(n);var t=k(e,this.schema.primKey.keyPath);return void 0===t?e7(new X.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(t).modify(n)},e.prototype.put=function(e,n){var t=this,r=this.schema.primKey,i=r.auto,o=r.keyPath,a=e;return o&&i&&(a=na(o)(e)),this._trans("readwrite",function(e){return t.core.mutate({trans:e,type:"put",values:[a],keys:null!=n?[n]:null})}).then(function(e){return e.numFailures?eS.reject(e.failures[0]):e.lastResult}).then(function(n){if(o)try{K(e,o,n)}catch(t){}return n})},e.prototype.delete=function(e){var n=this;return this._trans("readwrite",function(t){return n.core.mutate({trans:t,type:"delete",keys:[e]})}).then(function(e){return e.numFailures?eS.reject(e.failures[0]):void 0})},e.prototype.clear=function(){var e=this;return this._trans("readwrite",function(n){return e.core.mutate({trans:n,type:"deleteRange",range:no})}).then(function(e){return e.numFailures?eS.reject(e.failures[0]):void 0})},e.prototype.bulkGet=function(e){var n=this;return this._trans("readonly",function(t){return n.core.getMany({keys:e,trans:t}).then(function(e){return e.map(function(e){return n.hook.reading.fire(e)})})})},e.prototype.bulkAdd=function(e,n,t){var r=this,i=Array.isArray(n)?n:void 0,o=(t=t||(i?void 0:n))?t.allKeys:void 0;return this._trans("readwrite",function(n){var t=r.schema.primKey,a=t.auto,u=t.keyPath;if(u&&i)throw new X.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(i&&i.length!==e.length)throw new X.InvalidArgument("Arguments objects and keys must have the same length");var s=e.length,c=u&&a?e.map(na(u)):e;return r.core.mutate({trans:n,type:"add",keys:i,values:c,wantResults:o}).then(function(e){var n=e.numFailures,t=e.results,i=e.lastResult,a=e.failures;if(0===n)return o?t:i;throw new W("".concat(r.name,".bulkAdd(): ").concat(n," of ").concat(s," operations failed"),a)})})},e.prototype.bulkPut=function(e,n,t){var r=this,i=Array.isArray(n)?n:void 0,o=(t=t||(i?void 0:n))?t.allKeys:void 0;return this._trans("readwrite",function(n){var t=r.schema.primKey,a=t.auto,u=t.keyPath;if(u&&i)throw new X.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(i&&i.length!==e.length)throw new X.InvalidArgument("Arguments objects and keys must have the same length");var s=e.length,c=u&&a?e.map(na(u)):e;return r.core.mutate({trans:n,type:"put",keys:i,values:c,wantResults:o}).then(function(e){var n=e.numFailures,t=e.results,i=e.lastResult,a=e.failures;if(0===n)return o?t:i;throw new W("".concat(r.name,".bulkPut(): ").concat(n," of ").concat(s," operations failed"),a)})})},e.prototype.bulkUpdate=function(e){var n=this,t=this.core,r=e.map(function(e){return e.key}),i=e.map(function(e){return e.changes}),o=[];return this._trans("readwrite",function(a){return t.getMany({trans:a,keys:r,cache:"clone"}).then(function(u){var s=[],c=[];e.forEach(function(e,t){var r=e.key,i=e.changes,a=u[t];if(a){for(var l=0,f=Object.keys(i);l<f.length;l++){var h=f[l],d=i[h];if(h===n.schema.primKey.keyPath){if(0!==ns(d,r))throw new X.Constraint("Cannot update primary key in bulkUpdate()")}else K(a,h,d)}o.push(t),s.push(r),c.push(a)}});var l=s.length;return t.mutate({trans:a,type:"put",keys:s,values:c,updates:{keys:r,changeSpecs:i}}).then(function(e){var t=e.numFailures,r=e.failures;if(0===t)return l;for(var i=0,a=Object.keys(r);i<a.length;i++){var u=a[i],s=o[Number(u)];if(null!=s){var c=r[u];delete r[u],r[s]=c}}throw new W("".concat(n.name,".bulkUpdate(): ").concat(t," of ").concat(l," operations failed"),r)})})})},e.prototype.bulkDelete=function(e){var n=this,t=e.length;return this._trans("readwrite",function(t){return n.core.mutate({trans:t,type:"delete",keys:e})}).then(function(e){var r=e.numFailures,i=e.lastResult,o=e.failures;if(0===r)return i;throw new W("".concat(n.name,".bulkDelete(): ").concat(r," of ").concat(t," operations failed"),o)})},e}();function nh(e){var n={},t=function(t,r){if(r){for(var i=arguments.length,o=Array(i-1);--i;)o[i-1]=arguments[i];return n[t].subscribe.apply(null,o),e}if("string"==typeof t)return n[t]};t.addEventType=o;for(var r=1,i=arguments.length;r<i;++r)o(arguments[r]);return t;function o(e,r,i){if("object"==typeof e)return function e(n){s(n).forEach(function(e){var t=n[e];if(c(t))o(e,n[e][0],n[e][1]);else if("asap"===t)var r=o(e,ee,function e(){for(var n=arguments.length,t=Array(n);n--;)t[n]=arguments[n];r.subscribers.forEach(function(e){x(function n(){e.apply(null,t)})})});else throw new X.InvalidArgument("Invalid event config")})}(e);r||(r=ea),i||(i=Z);var a={subscribers:[],fire:i,subscribe:function(e){-1===a.subscribers.indexOf(e)&&(a.subscribers.push(e),a.fire=r(a.fire,e))},unsubscribe:function(e){a.subscribers=a.subscribers.filter(function(n){return n!==e}),a.fire=a.subscribers.reduce(r,i)}};return n[e]=t[e]=a,a}}function nd(e,n){return m(n).from({prototype:e}),n}function np(e,n){return!(e.filter||e.algorithm||e.or)&&(n?e.justLimit:!e.replayFilter)}function ny(e,n){e.filter=ni(e.filter,n)}function nv(e,n,t){var r=e.replayFilter;e.replayFilter=r?function(){return ni(r(),n())}:n,e.justLimit=t&&!r}function nm(e,n){if(e.isPrimKey)return n.primaryKey;var t=n.getIndexByKeyPath(e.index);if(!t)throw new X.Schema("KeyPath "+e.index+" on object store "+n.name+" is not indexed");return t}function nb(e,n,t){var r=nm(e,n.schema);return n.openCursor({trans:t,values:!e.keysOnly,reverse:"prev"===e.dir,unique:!!e.unique,query:{index:r,range:e.range}})}function ng(e,n,t,r){var i=e.replayFilter?ni(e.filter,e.replayFilter()):e.filter;if(!e.or)return n$(nb(e,r,t),ni(e.algorithm,i),n,!e.keysOnly&&e.valueMapper);var o={},a=function(e,t,r){if(!i||i(t,r,function(e){return t.stop(e)},function(e){return t.fail(e)})){var a=t.primaryKey,u=""+a;"[object ArrayBuffer]"===u&&(u=""+new Uint8Array(a)),d(o,u)||(o[u]=!0,n(e,t,r))}};return Promise.all([e.or._iterate(a,t),n$(nb(e,r,t),e.algorithm,a,!e.keysOnly&&e.valueMapper)])}function n$(e,n,t,r){var i=eN(r?function(e,n,i){return t(r(e),n,i)}:t);return e.then(function(e){if(e)return e.start(function(){var t=function(){return e.continue()};(!n||n(e,function(e){return t=e},function(n){e.stop(n),t=Z},function(n){e.fail(n),t=Z}))&&i(e.value,e,function(e){return t=e}),t()})})}var nw=function(){function e(e){this["@@propmod"]=e}return e.prototype.execute=function(e){var n,t=this["@@propmod"];if(void 0!==t.add){var r=t.add;if(c(r))return a(a([],c(e)?e:[],!0),r,!0).sort();if("number"==typeof r)return(Number(e)||0)+r;if("bigint"==typeof r)try{return BigInt(e)+r}catch(i){return BigInt(0)+r}throw TypeError("Invalid term ".concat(r))}if(void 0!==t.remove){var o=t.remove;if(c(o))return c(e)?e.filter(function(e){return!o.includes(e)}).sort():[];if("number"==typeof o)return Number(e)-o;if("bigint"==typeof o)try{return BigInt(e)-o}catch(u){return BigInt(0)-o}throw TypeError("Invalid subtrahend ".concat(o))}var s=null===(n=t.replacePrefix)||void 0===n?void 0:n[0];return s&&"string"==typeof e&&e.startsWith(s)?t.replacePrefix[1]+e.substring(s.length):e},e}(),n8=function(){function e(){}return e.prototype._read=function(e,n){var t=this._ctx;return t.error?t.table._trans(null,e7.bind(null,t.error)):t.table._trans("readonly",e).then(n)},e.prototype._write=function(e){var n=this._ctx;return n.error?n.table._trans(null,e7.bind(null,n.error)):n.table._trans("readwrite",e,"locked")},e.prototype._addAlgorithm=function(e){var n=this._ctx;n.algorithm=ni(n.algorithm,e)},e.prototype._iterate=function(e,n){return ng(this._ctx,e,n,this._ctx.table.core)},e.prototype.clone=function(e){var n=Object.create(this.constructor.prototype),t=Object.create(this._ctx);return e&&l(t,e),n._ctx=t,n},e.prototype.raw=function(){return this._ctx.valueMapper=null,this},e.prototype.each=function(e){var n=this._ctx;return this._read(function(t){return ng(n,e,t,n.table.core)})},e.prototype.count=function(e){var n=this;return this._read(function(e){var t=n._ctx,r=t.table.core;if(np(t,!0))return r.count({trans:e,query:{index:nm(t,r.schema),range:t.range}}).then(function(e){return Math.min(e,t.limit)});var i=0;return ng(t,function(){return++i,!1},e,r).then(function(){return i})}).then(e)},e.prototype.sortBy=function(e,n){var t=e.split(".").reverse(),r=t[0],i=t.length-1;function o(e,n){return n?o(e[t[n]],n-1):e[r]}var a="next"===this._ctx.dir?1:-1;function u(e,n){var t=o(e,i),r=o(n,i);return ns(t,r)*a}return this.toArray(function(e){return e.sort(u)}).then(n)},e.prototype.toArray=function(e){var n=this;return this._read(function(e){var t=n._ctx;if("next"===t.dir&&np(t,!0)&&t.limit>0){var r=t.valueMapper,i=nm(t,t.table.core.schema);return t.table.core.query({trans:e,limit:t.limit,values:!0,query:{index:i,range:t.range}}).then(function(e){var n=e.result;return r?n.map(r):n})}var o=[];return ng(t,function(e){return o.push(e)},e,t.table.core).then(function(){return o})},e)},e.prototype.offset=function(e){var n=this._ctx;return e<=0||(n.offset+=e,np(n)?nv(n,function(){var n=e;return function(e,t){return 0===n||(1===n?(--n,!1):(t(function(){e.advance(n),n=0}),!1))}}):nv(n,function(){var n=e;return function(){return--n<0}})),this},e.prototype.limit=function(e){return this._ctx.limit=Math.min(this._ctx.limit,e),nv(this._ctx,function(){var n=e;return function(e,t,r){return--n<=0&&t(r),n>=0}},!0),this},e.prototype.until=function(e,n){return ny(this._ctx,function(t,r,i){return!e(t.value)||(r(i),n)}),this},e.prototype.first=function(e){return this.limit(1).toArray(function(e){return e[0]}).then(e)},e.prototype.last=function(e){return this.reverse().first(e)},e.prototype.filter=function(e){var n,t;return ny(this._ctx,function(n){return e(n.value)}),n=this._ctx,t=e,n.isMatch=ni(n.isMatch,t),this},e.prototype.and=function(e){return this.filter(e)},e.prototype.or=function(e){return new this.db.WhereClause(this._ctx.table,e,this)},e.prototype.reverse=function(){return this._ctx.dir="prev"===this._ctx.dir?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},e.prototype.desc=function(){return this.reverse()},e.prototype.eachKey=function(e){var n=this._ctx;return n.keysOnly=!n.isMatch,this.each(function(n,t){e(t.key,t)})},e.prototype.eachUniqueKey=function(e){return this._ctx.unique="unique",this.eachKey(e)},e.prototype.eachPrimaryKey=function(e){var n=this._ctx;return n.keysOnly=!n.isMatch,this.each(function(n,t){e(t.primaryKey,t)})},e.prototype.keys=function(e){var n=this._ctx;n.keysOnly=!n.isMatch;var t=[];return this.each(function(e,n){t.push(n.key)}).then(function(){return t}).then(e)},e.prototype.primaryKeys=function(e){var n=this._ctx;if("next"===n.dir&&np(n,!0)&&n.limit>0)return this._read(function(e){var t=nm(n,n.table.core.schema);return n.table.core.query({trans:e,values:!1,limit:n.limit,query:{index:t,range:n.range}})}).then(function(e){return e.result}).then(e);n.keysOnly=!n.isMatch;var t=[];return this.each(function(e,n){t.push(n.primaryKey)}).then(function(){return t}).then(e)},e.prototype.uniqueKeys=function(e){return this._ctx.unique="unique",this.keys(e)},e.prototype.firstKey=function(e){return this.limit(1).keys(function(e){return e[0]}).then(e)},e.prototype.lastKey=function(e){return this.reverse().firstKey(e)},e.prototype.distinct=function(){var e=this._ctx,n=e.index&&e.table.schema.idxByName[e.index];if(!n||!n.multi)return this;var t={};return ny(this._ctx,function(e){var n=e.primaryKey.toString(),r=d(t,n);return t[n]=!0,!r}),this},e.prototype.modify=function(e){var n=this,t=this._ctx;return this._write(function(r){if("function"==typeof e)i=e;else{var i,o=s(e),a=o.length;i=function(n){for(var t=!1,r=0;r<a;++r){var i=o[r],u=e[i],s=k(n,i);u instanceof nw?(K(n,i,u.execute(s)),t=!0):s!==u&&(K(n,i,u),t=!0)}return t}}var u=t.table.core,c=u.schema.primaryKey,l=c.outbound,f=c.extractKey,h=200,d=n.db._options.modifyChunkSize;d&&(h="object"==typeof d?d[u.name]||d["*"]||200:d);var p=[],y=0,v=[],m=function(e,n){var t=n.failures;y+=e-n.numFailures;for(var r=0,i=s(t);r<i.length;r++){var o=i[r];p.push(t[o])}};return n.clone().primaryKeys().then(function(n){var o=np(t)&&t.limit===1/0&&("function"!=typeof e||e===n_)&&{index:t.index,range:t.range},a=function(t){var s=Math.min(h,n.length-t);return u.getMany({trans:r,keys:n.slice(t,t+s),cache:"immutable"}).then(function(c){for(var d=[],p=[],y=l?[]:null,v=[],b=0;b<s;++b){var g=c[b],$={value:A(g),primKey:n[t+b]};!1!==i.call($,$.value,$)&&(null==$.value?v.push(n[t+b]):l||0===ns(f(g),f($.value))?(p.push($.value),l&&y.push(n[t+b])):(v.push(n[t+b]),d.push($.value)))}return Promise.resolve(d.length>0&&u.mutate({trans:r,type:"add",values:d}).then(function(e){for(var n in e.failures)v.splice(parseInt(n),1);m(d.length,e)})).then(function(){return(p.length>0||o&&"object"==typeof e)&&u.mutate({trans:r,type:"put",keys:y,values:p,criteria:o,changeSpec:"function"!=typeof e&&e,isAdditionalChunk:t>0}).then(function(e){return m(p.length,e)})}).then(function(){return(v.length>0||o&&e===n_)&&u.mutate({trans:r,type:"delete",keys:v,criteria:o,isAdditionalChunk:t>0}).then(function(e){return m(v.length,e)})}).then(function(){return n.length>t+s&&a(t+h)})})};return a(0).then(function(){if(p.length>0)throw new Y("Error modifying one or more objects",p,y,v);return n.length})})})},e.prototype.delete=function(){var e=this._ctx,n=e.range;return np(e)&&(e.isPrimKey||3===n.type)?this._write(function(t){var r=e.table.core.schema.primaryKey,i=n;return e.table.core.count({trans:t,query:{index:r,range:i}}).then(function(n){return e.table.core.mutate({trans:t,type:"deleteRange",range:i}).then(function(e){var t=e.failures;e.lastResult,e.results;var r=e.numFailures;if(r)throw new Y("Could not delete some values",Object.keys(t).map(function(e){return t[e]}),n-r);return n-r})})}):this.modify(n_)},e}(),n_=function(e,n){return n.value=null};function nx(e,n){return e<n?-1:e===n?0:1}function nk(e,n){return e>n?-1:e===n?0:1}function nK(e,n,t){var r=e instanceof nD?new e.Collection(e):e;return r._ctx.error=t?new t(n):TypeError(n),r}function nP(e){return new e.Collection(e,function(){return nE("")}).limit(0)}function nO(e,n,t,r,i,o){for(var a=Math.min(e.length,r.length),u=-1,s=0;s<a;++s){var c=n[s];if(c!==r[s]){if(0>i(e[s],t[s]))return e.substr(0,s)+t[s]+t.substr(s+1);if(0>i(e[s],r[s]))return e.substr(0,s)+r[s]+t.substr(s+1);if(u>=0)return e.substr(0,u)+n[u]+t.substr(u+1);return null}0>i(e[s],c)&&(u=s)}return a<r.length&&"next"===o?e+t.substr(e.length):a<e.length&&"prev"===o?e.substr(0,t.length):u<0?null:e.substr(0,u)+r[u]+t.substr(u+1)}function nS(e,n,t,r){var i,o,a,u,s,c,l,f=t.length;if(!t.every(function(e){return"string"==typeof e}))return nK(e,eZ);function h(e){i="next"===(n=e)?function(e){return e.toUpperCase()}:function(e){return e.toLowerCase()},o="next"===(f=e)?function(e){return e.toLowerCase()}:function(e){return e.toUpperCase()},a="next"===e?nx:nk;var n,f,h=t.map(function(e){return{lower:o(e),upper:i(e)}}).sort(function(e,n){return a(e.lower,n.lower)});u=h.map(function(e){return e.upper}),s=h.map(function(e){return e.lower}),c=e,l="next"===e?"":r}h("next");var d=new e.Collection(e,function(){return nC(u[0],s[f-1]+r)});d._ondirectionchange=function(e){h(e)};var p=0;return d._addAlgorithm(function(e,t,r){var i=e.key;if("string"!=typeof i)return!1;var h=o(i);if(n(h,s,p))return!0;for(var d=null,y=p;y<f;++y){var v=nO(i,h,u[y],s[y],a,c);null===v&&null===d?p=y+1:(null===d||a(d,v)>0)&&(d=v)}return t(null!==d?function(){e.continue(d+l)}:r),!1}),d}function nC(e,n,t,r){return{type:2,lower:e,upper:n,lowerOpen:t,upperOpen:r}}function nE(e){return{type:1,lower:e,upper:e}}var nD=function(){function e(){}return Object.defineProperty(e.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),e.prototype.between=function(e,n,t,r){t=!1!==t,r=!0===r;try{if(this._cmp(e,n)>0||0===this._cmp(e,n)&&(t||r)&&!(t&&r))return nP(this);return new this.Collection(this,function(){return nC(e,n,!t,!r)})}catch(i){return nK(this,eJ)}},e.prototype.equals=function(e){return null==e?nK(this,eJ):new this.Collection(this,function(){return nE(e)})},e.prototype.above=function(e){return null==e?nK(this,eJ):new this.Collection(this,function(){return nC(e,void 0,!0)})},e.prototype.aboveOrEqual=function(e){return null==e?nK(this,eJ):new this.Collection(this,function(){return nC(e,void 0,!1)})},e.prototype.below=function(e){return null==e?nK(this,eJ):new this.Collection(this,function(){return nC(void 0,e,!1,!0)})},e.prototype.belowOrEqual=function(e){return null==e?nK(this,eJ):new this.Collection(this,function(){return nC(void 0,e)})},e.prototype.startsWith=function(e){return"string"!=typeof e?nK(this,eZ):this.between(e,e+"￿",!0,!0)},e.prototype.startsWithIgnoreCase=function(e){return""===e?this.startsWith(e):nS(this,function(e,n){return 0===e.indexOf(n[0])},[e],"￿")},e.prototype.equalsIgnoreCase=function(e){return nS(this,function(e,n){return e===n[0]},[e],"")},e.prototype.anyOfIgnoreCase=function(){var e=F.apply(T,arguments);return 0===e.length?nP(this):nS(this,function(e,n){return -1!==n.indexOf(e)},e,"")},e.prototype.startsWithAnyOfIgnoreCase=function(){var e=F.apply(T,arguments);return 0===e.length?nP(this):nS(this,function(e,n){return n.some(function(n){return 0===e.indexOf(n)})},e,"￿")},e.prototype.anyOf=function(){var e=this,n=F.apply(T,arguments),t=this._cmp;try{n.sort(t)}catch(r){return nK(this,eJ)}if(0===n.length)return nP(this);var i=new this.Collection(this,function(){return nC(n[0],n[n.length-1])});i._ondirectionchange=function(r){t="next"===r?e._ascending:e._descending,n.sort(t)};var o=0;return i._addAlgorithm(function(e,r,i){for(var a=e.key;t(a,n[o])>0;)if(++o===n.length)return r(i),!1;return 0===t(a,n[o])||(r(function(){e.continue(n[o])}),!1)}),i},e.prototype.notEqual=function(e){return this.inAnyRange([[e5,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},e.prototype.noneOf=function(){var e=F.apply(T,arguments);if(0===e.length)return new this.Collection(this);try{e.sort(this._ascending)}catch(n){return nK(this,eJ)}var t=e.reduce(function(e,n){return e?e.concat([[e[e.length-1][1],n]]):[[e5,n]]},null);return t.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(t,{includeLowers:!1,includeUppers:!1})},e.prototype.inAnyRange=function(e,n){var t,r=this,i=this._cmp,o=this._ascending,a=this._descending,u=this._min,s=this._max;if(0===e.length)return nP(this);if(!e.every(function(e){return void 0!==e[0]&&void 0!==e[1]&&0>=o(e[0],e[1])}))return nK(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",X.InvalidArgument);var c=!n||!1!==n.includeLowers,l=n&&!0===n.includeUppers,f=o;function h(e,n){return f(e[0],n[0])}try{(t=e.reduce(function e(n,t){for(var r=0,o=n.length;r<o;++r){var a=n[r];if(0>i(t[0],a[1])&&i(t[1],a[0])>0){a[0]=u(a[0],t[0]),a[1]=s(a[1],t[1]);break}}return r===o&&n.push(t),n},[])).sort(h)}catch(d){return nK(this,eJ)}var p=0,y=l?function(e){return o(e,t[p][1])>0}:function(e){return o(e,t[p][1])>=0},v=c?function(e){return a(e,t[p][0])>0}:function(e){return a(e,t[p][0])>=0},m=y,b=new this.Collection(this,function(){return nC(t[0][0],t[t.length-1][1],!c,!l)});return b._ondirectionchange=function(e){"next"===e?(m=y,f=o):(m=v,f=a),t.sort(h)},b._addAlgorithm(function(e,n,i){for(var a,u=e.key;m(u);)if(++p===t.length)return n(i),!1;return!(y(a=u)||v(a))||0!==r._cmp(u,t[p][1])&&0!==r._cmp(u,t[p][0])&&(n(function(){f===o?e.continue(t[p][0]):e.continue(t[p][1])}),!1)}),b},e.prototype.startsWithAnyOf=function(){var e=F.apply(T,arguments);return e.every(function(e){return"string"==typeof e})?0===e.length?nP(this):this.inAnyRange(e.map(function(e){return[e,e+"￿"]})):nK(this,"startsWithAnyOf() only works with strings")},e}();function nA(e){return eN(function(n){return nq(n),e(n.target.error),!1})}function nq(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}var nI="storagemutated",nB="x-storagemutated-1",nR=nh(null,nI),nj=function(){function e(){}return e.prototype._lock=function(){return _(!ek.global),++this._reculock,1!==this._reculock||ek.global||(ek.lockOwnerFor=this),this},e.prototype._unlock=function(){if(_(!ek.global),0==--this._reculock)for(ek.global||(ek.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var e=this._blockedFuncs.shift();try{e4(e[1],e[0])}catch(n){}}return this},e.prototype._locked=function(){return this._reculock&&ek.lockOwnerFor!==this},e.prototype.create=function(e){var n=this;if(!this.mode)return this;var t=this.db.idbdb,r=this.db._state.dbOpenError;if(_(!this.idbtrans),!e&&!t)switch(r&&r.name){case"DatabaseClosedError":throw new X.DatabaseClosed(r);case"MissingAPIError":throw new X.MissingAPI(r.message,r);default:throw new X.OpenFailed(r)}if(!this.active)throw new X.TransactionInactive;return _(null===this._completion._state),(e=this.idbtrans=e||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):t.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}))).onerror=eN(function(t){nq(t),n._reject(e.error)}),e.onabort=eN(function(t){nq(t),n.active&&n._reject(new X.Abort(e.error)),n.active=!1,n.on("abort").fire(t)}),e.oncomplete=eN(function(){n.active=!1,n._resolve(),"mutatedParts"in e&&nR.storagemutated.fire(e.mutatedParts)}),this},e.prototype._promise=function(e,n,t){var r=this;if("readwrite"===e&&"readwrite"!==this.mode)return e7(new X.ReadOnly("Transaction is readonly"));if(!this.active)return e7(new X.TransactionInactive);if(this._locked())return new eS(function(i,o){r._blockedFuncs.push([function(){r._promise(e,n,t).then(i,o)},ek])});if(t)return e1(function(){var e=new eS(function(e,t){r._lock();var i=n(e,t,r);i&&i.then&&i.then(e,t)});return e.finally(function(){return r._unlock()}),e._lib=!0,e});var i=new eS(function(e,t){var i=n(e,t,r);i&&i.then&&i.then(e,t)});return i._lib=!0,i},e.prototype._root=function(){return this.parent?this.parent._root():this},e.prototype.waitFor=function(e){var n=this._root(),t=eS.resolve(e);if(n._waitingFor)n._waitingFor=n._waitingFor.then(function(){return t});else{n._waitingFor=t,n._waitingQueue=[];var r=n.idbtrans.objectStore(n.storeNames[0]);!function e(){for(++n._spinCount;n._waitingQueue.length;)n._waitingQueue.shift()();n._waitingFor&&(r.get(-1/0).onsuccess=e)}()}var i=n._waitingFor;return new eS(function(e,r){t.then(function(t){return n._waitingQueue.push(eN(e.bind(null,t)))},function(e){return n._waitingQueue.push(eN(r.bind(null,e)))}).finally(function(){n._waitingFor===i&&(n._waitingFor=null)})})},e.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new X.Abort))},e.prototype.table=function(e){var n=this._memoizedTables||(this._memoizedTables={});if(d(n,e))return n[e];var t=this.schema[e];if(!t)throw new X.NotFound("Table "+e+" not part of transaction");var r=new this.db.Table(e,t,this);return r.core=this.db.core.table(e),n[e]=r,r},e}();function nT(e,n,t,r,i,o,a){return{name:e,keyPath:n,unique:t,multi:r,auto:i,compound:o,src:(t&&!a?"&":"")+(r?"*":"")+(i?"++":"")+nF(n)}}function nF(e){return"string"==typeof e?e:e?"["+[].join.call(e,"+")+"]":""}function nN(e,n,t){var r,i;return{name:e,primKey:n,indexes:t,mappedClass:null,idxByName:(r=t,i=function(e){return[e.name,e]},r.reduce(function(e,n,t){var r=i(n,t);return r&&(e[r[0]]=r[1]),e},{}))}}var nM=function(e){try{return e.only([[]]),nM=function(){return[[]]},[[]]}catch(n){return nM=function(){return"￿"},"￿"}};function nL(e){var n;return null==e?function(){}:"string"==typeof e?(n=e,1===n.split(".").length?function(e){return e[n]}:function(e){return k(e,n)}):function(n){return k(n,e)}}function nU(e){return[].slice.call(e)}var nV=0;function nz(e){return null==e?":id":"string"==typeof e?e:"[".concat(e.join("+"),"]")}function n0(e,n){var t,r,i,a,u,s,l,f=n.db,h=(t=e._middlewares,r=f,i=e._deps,a=n,u=i.IDBKeyRange,i.indexedDB,{dbcore:(s=function e(n,t,r){function i(e){if(3===e.type)return null;if(4===e.type)throw Error("Cannot convert never type to IDBKeyRange");var n=e.lower,r=e.upper,i=e.lowerOpen,o=e.upperOpen;return void 0===n?void 0===r?null:t.upperBound(r,!!o):void 0===r?t.lowerBound(n,!!i):t.bound(n,r,!!i,!!o)}var o,a,u,s=(o=n,a=r,u=nU(o.objectStoreNames),{schema:{name:o.name,tables:u.map(function(e){return a.objectStore(e)}).map(function(e){var n=e.keyPath,t=e.autoIncrement,r=c(n),i={},o={name:e.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:null==n,compound:r,keyPath:n,autoIncrement:t,unique:!0,extractKey:nL(n)},indexes:nU(e.indexNames).map(function(n){return e.index(n)}).map(function(e){var n=e.name,t=e.unique,r=e.multiEntry,o=e.keyPath,a=c(o),u={name:n,compound:a,keyPath:o,unique:t,multiEntry:r,extractKey:nL(o)};return i[nz(o)]=u,u}),getIndexByKeyPath:function(e){return i[nz(e)]}};return i[":id"]=o.primaryKey,null!=n&&(i[nz(n)]=o.primaryKey),o})},hasGetAll:u.length>0&&"getAll"in a.objectStore(u[0])&&!("undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}),l=s.schema,f=s.hasGetAll,h=l.tables.map(function(e){var n,t,r;return{name:t=(n=e).name,schema:n,mutate:function e(n){var r=n.trans,o=n.type,a=n.keys,u=n.values,s=n.range;return new Promise(function(e,n){e=eN(e);var c,l=r.objectStore(t),f=null==l.keyPath,h="put"===o||"add"===o;if(!h&&"delete"!==o&&"deleteRange"!==o)throw Error("Invalid operation type: "+o);var d=(a||u||{length:1}).length;if(a&&u&&a.length!==u.length)throw Error("Given keys array must have same length as given values array.");if(0===d)return e({numFailures:0,failures:{},results:[],lastResult:void 0});var p=[],y=[],v=0,m=function(e){++v,nq(e)};if("deleteRange"===o){if(4===s.type)return e({numFailures:v,failures:y,results:[],lastResult:void 0});3===s.type?p.push(c=l.clear()):p.push(c=l.delete(i(s)))}else{var b=h?f?[u,a]:[u,null]:[a,null],g=b[0],$=b[1];if(h)for(var w=0;w<d;++w)p.push(c=$&&void 0!==$[w]?l[o](g[w],$[w]):l[o](g[w])),c.onerror=m;else for(var w=0;w<d;++w)p.push(c=l[o](g[w])),c.onerror=m}var _=function(n){var t=n.target.result;p.forEach(function(e,n){return null!=e.error&&(y[n]=e.error)}),e({numFailures:v,failures:y,results:"delete"===o?a:p.map(function(e){return e.result}),lastResult:t})};c.onerror=function(e){m(e),_(e)},c.onsuccess=_})},getMany:function(e){var n=e.trans,r=e.keys;return new Promise(function(e,i){e=eN(e);for(var o,a=n.objectStore(t),u=r.length,s=Array(u),c=0,l=0,f=function(n){var t=n.target;s[t._pos]=t.result,++l===c&&e(s)},h=nA(i),d=0;d<u;++d)null!=r[d]&&((o=a.get(r[d]))._pos=d,o.onsuccess=f,o.onerror=h,++c);0===c&&e(s)})},get:function(e){var n=e.trans,r=e.key;return new Promise(function(e,i){e=eN(e);var o=n.objectStore(t).get(r);o.onsuccess=function(n){return e(n.target.result)},o.onerror=nA(i)})},query:(r=f,function(e){return new Promise(function(n,o){n=eN(n);var a=e.trans,u=e.values,s=e.limit,c=e.query,l=s===1/0?void 0:s,f=c.index,h=c.range,d=a.objectStore(t),p=f.isPrimaryKey?d:d.index(f.name),y=i(h);if(0===s)return n({result:[]});if(r){var v=u?p.getAll(y,l):p.getAllKeys(y,l);v.onsuccess=function(e){return n({result:e.target.result})},v.onerror=nA(o)}else{var m=0,b=!u&&"openKeyCursor"in p?p.openKeyCursor(y):p.openCursor(y),g=[];b.onsuccess=function(e){var t=b.result;return t?(g.push(u?t.value:t.primaryKey),++m===s)?n({result:g}):void t.continue():n({result:g})},b.onerror=nA(o)}})}),openCursor:function e(n){var r=n.trans,o=n.values,a=n.query,u=n.reverse,s=n.unique;return new Promise(function(e,n){e=eN(e);var c=a.index,l=a.range,f=r.objectStore(t),h=c.isPrimaryKey?f:f.index(c.name),d=u?s?"prevunique":"prev":s?"nextunique":"next",p=!o&&"openKeyCursor"in h?h.openKeyCursor(i(l),d):h.openCursor(i(l),d);p.onerror=nA(n),p.onsuccess=eN(function(t){var i=p.result;if(!i){e(null);return}i.___id=++nV,i.done=!1;var o=i.continue.bind(i),a=i.continuePrimaryKey;a&&(a=a.bind(i));var u=i.advance.bind(i),s=function(){throw Error("Cursor not started")},c=function(){throw Error("Cursor not stopped")};i.trans=r,i.stop=i.continue=i.continuePrimaryKey=i.advance=s,i.fail=eN(n),i.next=function(){var e=this,n=1;return this.start(function(){return n--?e.continue():e.stop()}).then(function(){return e})},i.start=function(e){var n=new Promise(function(e,n){e=eN(e),p.onerror=nA(n),i.fail=n,i.stop=function(n){i.stop=i.continue=i.continuePrimaryKey=i.advance=c,e(n)}}),t=function(){if(p.result)try{e()}catch(n){i.fail(n)}else i.done=!0,i.start=function(){throw Error("Cursor behind last entry")},i.stop()};return p.onsuccess=eN(function(e){p.onsuccess=t,t()}),i.continue=o,i.continuePrimaryKey=a,i.advance=u,t(),n},e(i)},n)})},count:function(e){var n=e.query,r=e.trans,o=n.index,a=n.range;return new Promise(function(e,n){var u=r.objectStore(t),s=o.isPrimaryKey?u:u.index(o.name),c=i(a),l=c?s.count(c):s.count();l.onsuccess=eN(function(n){return e(n.target.result)}),l.onerror=nA(n)})}}}),d={};return h.forEach(function(e){return d[e.name]=e}),{stack:"dbcore",transaction:n.transaction.bind(n),table:function(e){if(!d[e])throw Error("Table '".concat(e,"' not found"));return d[e]},MIN_KEY:-1/0,MAX_KEY:nM(t),schema:l}}(r,u,a),(l=t.dbcore).reduce(function(e,n){var t=n.create;return o(o({},e),t(e))},s))});e.core=h.dbcore,e.tables.forEach(function(n){var t=n.name;e.core.schema.tables.some(function(e){return e.name===t})&&(n.core=e.core.table(t),e[t]instanceof e.Table&&(e[t].core=n.core))})}function n1(e,n,t,r){t.forEach(function(t){var i=r[t];n.forEach(function(n){var r=function e(n,t){var r;return b(n,t)||(r=f(n))&&e(r,t)}(n,t);(!r||"value"in r&&void 0===r.value)&&(n===e.Transaction.prototype||n instanceof e.Transaction?v(n,t,{get:function(){return this.table(t)},set:function(e){y(this,t,{value:e,writable:!0,configurable:!0,enumerable:!0})}}):n[t]=new e.Table(t,i))})})}function nY(e,n){n.forEach(function(n){for(var t in n)n[t]instanceof e.Table&&delete n[t]})}function nW(e,n){return e._cfg.version-n._cfg.version}function n9(e,n){var t,r={del:[],add:[],change:[]};for(t in e)n[t]||r.del.push(t);for(t in n){var i=e[t],o=n[t];if(i){var a={name:t,def:o,recreate:!1,del:[],add:[],change:[]};if(""+(i.primKey.keyPath||"")!=""+(o.primKey.keyPath||"")||i.primKey.auto!==o.primKey.auto)a.recreate=!0,r.change.push(a);else{var u=i.idxByName,s=o.idxByName,c=void 0;for(c in u)s[c]||a.del.push(c);for(c in s){var l=u[c],f=s[c];l?l.src!==f.src&&a.change.push(f):a.add.push(f)}(a.del.length>0||a.add.length>0||a.change.length>0)&&r.change.push(a)}}else r.add.push([t,o])}return r}function n6(e,n,t,r){var i=e.db.createObjectStore(n,t.keyPath?{keyPath:t.keyPath,autoIncrement:t.auto}:{autoIncrement:t.auto});return r.forEach(function(e){return nG(i,e)}),i}function nQ(e,n){s(e).forEach(function(t){n.db.objectStoreNames.contains(t)||(es&&console.debug("Dexie: Creating missing table",t),n6(n,t,e[t].primKey,e[t].indexes))})}function nG(e,n){e.createIndex(n.name,n.keyPath,{unique:n.unique,multiEntry:n.multi})}function n2(e,n,t){var r={};return $(n.objectStoreNames,0).forEach(function(e){for(var n=t.objectStore(e),i=n.keyPath,o=nT(nF(i),i||"",!0,!1,!!n.autoIncrement,i&&"string"!=typeof i,!0),a=[],u=0;u<n.indexNames.length;++u){var s=n.index(n.indexNames[u]);i=s.keyPath;var c=nT(s.name,i,!!s.unique,!!s.multiEntry,!1,i&&"string"!=typeof i,!1);a.push(c)}r[e]=nN(e,o,a)}),r}function n4(e,n,t){for(var r=t.db.objectStoreNames,i=0;i<r.length;++i){var o=r[i],a=t.objectStore(o);e._hasGetAll="getAll"in a;for(var s=0;s<a.indexNames.length;++s){var c=a.indexNames[s],l=a.index(c).keyPath,f="string"==typeof l?l:"["+$(l).join("+")+"]";if(n[o]){var h=n[o].idxByName[f];h&&(h.name=c,delete n[o].idxByName[f],n[o].idxByName[c]=h)}}}"undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&u.WorkerGlobalScope&&u instanceof u.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(e._hasGetAll=!1)}function nX(e){return e.split(",").map(function(e,n){var t=(e=e.trim()).replace(/([&*]|\+\+)/g,""),r=/^\[/.test(t)?t.match(/^\[(.*)\]$/)[1].split("+"):t;return nT(t,r||null,/\&/.test(e),/\*/.test(e),/\+\+/.test(e),c(r),0===n)})}var nH=function(){function e(){}return e.prototype._parseStoresSpec=function(e,n){s(e).forEach(function(t){if(null!==e[t]){var r=nX(e[t]),i=r.shift();if(i.unique=!0,i.multi)throw new X.Schema("Primary key cannot be multi-valued");r.forEach(function(e){if(e.auto)throw new X.Schema("Only primary key can be marked as autoIncrement (++)");if(!e.keyPath)throw new X.Schema("Index must have a name and cannot be an empty string")}),n[t]=nN(t,i,r)}})},e.prototype.stores=function(e){var n=this.db;this._cfg.storesSource=this._cfg.storesSource?l(this._cfg.storesSource,e):e;var t=n._versions,r={},i={};return t.forEach(function(e){l(r,e._cfg.storesSource),i=e._cfg.dbschema={},e._parseStoresSpec(r,i)}),n._dbSchema=i,nY(n,[n._allTables,n,n.Transaction.prototype]),n1(n,[n._allTables,n,n.Transaction.prototype,this._cfg.tables],s(i),i),n._storeNames=s(i),this},e.prototype.upgrade=function(e){return this._cfg.contentUpgrade=eu(this._cfg.contentUpgrade||Z,e),this},e}();function n7(e,n){var t=e._dbNamesDB;return t||(t=e._dbNamesDB=new tD(nn,{addons:[],indexedDB:e,IDBKeyRange:n})).version(1).stores({dbnames:"name"}),t.table("dbnames")}function n3(e){return e&&"function"==typeof e.databases}function n5(e){return e1(function(){return ek.letThrough=!0,e()})}function nJ(e){return!("from"in e)}var nZ=function(e,n){if(this)l(this,arguments.length?{d:1,from:e,to:arguments.length>1?n:e}:{d:0});else{var t=new nZ;return e&&"d"in e&&l(t,e),t}};function te(e,n,t){var r=ns(n,t);if(!isNaN(r)){if(r>0)throw RangeError();if(nJ(e))return l(e,{from:n,to:t,d:1});var i=e.l,o=e.r;if(0>ns(t,e.from))return i?te(i,n,t):e.l={from:n,to:t,d:1,l:null,r:null},ti(e);if(ns(n,e.to)>0)return o?te(o,n,t):e.r={from:n,to:t,d:1,l:null,r:null},ti(e);0>ns(n,e.from)&&(e.from=n,e.l=null,e.d=o?o.d+1:1),ns(t,e.to)>0&&(e.to=t,e.r=null,e.d=e.l?e.l.d+1:1);var a=!e.r;i&&!e.l&&tn(e,i),o&&a&&tn(e,o)}}function tn(e,n){nJ(n)||function e(n,t){var r=t.from,i=t.to,o=t.l,a=t.r;te(n,r,i),o&&e(n,o),a&&e(n,a)}(e,n)}function tt(e,n){var t=tr(n),r=t.next();if(r.done)return!1;for(var i=r.value,o=tr(e),a=o.next(i.from),u=a.value;!r.done&&!a.done;){if(0>=ns(u.from,i.to)&&ns(u.to,i.from)>=0)return!0;0>ns(i.from,u.from)?i=(r=t.next(u.from)).value:u=(a=o.next(i.from)).value}return!1}function tr(e){var n=nJ(e)?null:{s:0,n:e};return{next:function(e){for(var t=arguments.length>0;n;)switch(n.s){case 0:if(n.s=1,t)for(;n.n.l&&0>ns(e,n.n.from);)n={up:n,n:n.n.l,s:1};else for(;n.n.l;)n={up:n,n:n.n.l,s:1};case 1:if(n.s=2,!t||0>=ns(e,n.n.to))return{value:n.n,done:!1};case 2:if(n.n.r){n.s=3,n={up:n,n:n.n.r,s:0};continue}case 3:n=n.up}return{done:!0}}}}function ti(e){var n,t,r=((null===(n=e.r)||void 0===n?void 0:n.d)||0)-((null===(t=e.l)||void 0===t?void 0:t.d)||0),i=r>1?"r":r<-1?"l":"";if(i){var a="r"===i?"l":"r",u=o({},e),s=e[i];e.from=s.from,e.to=s.to,e[i]=s[i],u[i]=s[a],e[a]=u,u.d=to(u)}e.d=to(e)}function to(e){var n=e.r,t=e.l;return(n?t?Math.max(n.d,t.d):n.d:t?t.d:0)+1}function ta(e,n){return s(n).forEach(function(t){e[t]?tn(e[t],n[t]):e[t]=function e(n){var t={};for(var r in n)if(d(n,r)){var i=n[r];t[r]=!i||"object"!=typeof i||E.has(i.constructor)?i:e(i)}return t}(n[t])}),e}function tu(e,n){return e.all||n.all||Object.keys(e).some(function(t){return n[t]&&tt(n[t],e[t])})}p(nZ.prototype,((n={add:function(e){return tn(this,e),this},addKey:function(e){return te(this,e,e),this},addKeys:function(e){var n=this;return e.forEach(function(e){return te(n,e,e)}),this},hasKey:function(e){var n=tr(this).next(e).value;return n&&0>=ns(n.from,e)&&ns(n.to,e)>=0}})[B]=function(){return tr(this)},n));var ts={},tc={},tl=!1;function tf(e,n){ta(tc,e),tl||(tl=!0,setTimeout(function(){tl=!1;var e=tc;tc={},th(e,!1)},0))}function th(e,n){void 0===n&&(n=!1);var t=new Set;if(e.all)for(var r=0,i=Object.values(ts);r<i.length;r++){var o=i[r];td(o,e,t,n)}else for(var a in e){var u=/^idb\:\/\/(.*)\/(.*)\//.exec(a);if(u){var s=u[1],c=u[2],o=ts["idb://".concat(s,"/").concat(c)];o&&td(o,e,t,n)}}t.forEach(function(e){return e()})}function td(e,n,t,r){for(var i=[],o=0,a=Object.entries(e.queries.query);o<a.length;o++){for(var u=a[o],s=u[0],c=u[1],l=[],f=0,h=c;f<h.length;f++){var d=h[f];tu(n,d.obsSet)?d.subscribers.forEach(function(e){return t.add(e)}):r&&l.push(d)}r&&i.push([s,l])}if(r)for(var p=0,y=i;p<y.length;p++){var v=y[p],s=v[0],l=v[1];e.queries.query[s]=l}}function tp(e){var n=function(n){return e.next(n)},t=function(n){return e.throw(n)},r=o(n),i=o(t);function o(e){return function(n){var t=e(n),o=t.value;return t.done?o:o&&"function"==typeof o.then?o.then(r,i):c(o)?Promise.all(o).then(r,i):r(o)}}return o(n)()}function ty(e,n,t){var r=arguments.length;if(r<2)throw new X.InvalidArgument("Too few arguments");for(var i=Array(r-1);--r;)i[r-1]=arguments[r];t=i.pop();var o=S(i);return[e,o,t]}function tv(e,n,t){for(var r=c(e)?e.slice():[e],i=0;i<t;++i)r.push(n);return r}var tm={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function e(n){return o(o({},n),{table:function(e){var t=n.table(e),r=t.schema,i={},a=[];function u(e,n,t){var r=nz(e),s=i[r]=i[r]||[],c=null==e?0:"string"==typeof e?1:e.length,l=n>0,f=o(o({},t),{name:l?"".concat(r,"(virtual-from:").concat(t.name,")"):t.name,lowLevelIndex:t,isVirtual:l,keyTail:n,keyLength:c,extractKey:nL(e),unique:!l&&t.unique});return s.push(f),f.isPrimaryKey||a.push(f),c>1&&u(2===c?e[0]:e.slice(0,c-1),n+1,t),s.sort(function(e,n){return e.keyTail-n.keyTail}),f}var s=u(r.primaryKey.keyPath,0,r.primaryKey);i[":id"]=[s];for(var c=0,l=r.indexes;c<l.length;c++){var f=l[c];u(f.keyPath,0,f)}function h(e){var t,r,i=e.query.index;return i.isVirtual?o(o({},e),{query:{index:i.lowLevelIndex,range:(t=e.query.range,r=i.keyTail,{type:1===t.type?2:t.type,lower:tv(t.lower,t.lowerOpen?n.MAX_KEY:n.MIN_KEY,r),lowerOpen:!0,upper:tv(t.upper,t.upperOpen?n.MIN_KEY:n.MAX_KEY,r),upperOpen:!0})}}):e}return o(o({},t),{schema:o(o({},r),{primaryKey:s,indexes:a,getIndexByKeyPath:function e(n){var t=i[nz(n)];return t&&t[0]}}),count:function(e){return t.count(h(e))},query:function(e){return t.query(h(e))},openCursor:function(e){var r=e.query.index,i=r.keyTail,o=r.isVirtual,a=r.keyLength;return o?t.openCursor(h(e)).then(function(t){var r;return t&&Object.create(r=t,{continue:{value:function t(o){null!=o?r.continue(tv(o,e.reverse?n.MAX_KEY:n.MIN_KEY,i)):e.unique?r.continue(r.key.slice(0,a).concat(e.reverse?n.MIN_KEY:n.MAX_KEY,i)):r.continue()}},continuePrimaryKey:{value:function(e,t){r.continuePrimaryKey(tv(e,n.MAX_KEY,i),t)}},primaryKey:{get:function(){return r.primaryKey}},key:{get:function(){var e=r.key;return 1===a?e[0]:e.slice(0,a)}},value:{get:function(){return r.value}}})}):t.openCursor(e)}})}})}};function tb(e,n,t,r){return t=t||{},r=r||"",s(e).forEach(function(i){if(d(n,i)){var o=e[i],a=n[i];if("object"==typeof o&&"object"==typeof a&&o&&a){var u=I(o),s=I(a);u!==s?t[r+i]=n[i]:"Object"===u?tb(o,a,t,r+i+"."):o!==a&&(t[r+i]=n[i])}else o!==a&&(t[r+i]=n[i])}else t[r+i]=void 0}),s(n).forEach(function(i){d(e,i)||(t[r+i]=n[i])}),t}function tg(e,n){return"delete"===n.type?n.keys:n.keys||n.values.map(e.extractKey)}var t$={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(e){return o(o({},e),{table:function(n){var t=e.table(n),r=t.schema.primaryKey;return o(o({},t),{mutate:function(e){var i=ek.trans,u=i.table(n).hook,s=u.deleting,c=u.creating,l=u.updating;switch(e.type){case"add":if(c.fire===Z)break;return i._promise("readwrite",function(){return f(e)},!0);case"put":if(c.fire===Z&&l.fire===Z)break;return i._promise("readwrite",function(){return f(e)},!0);case"delete":if(s.fire===Z)break;return i._promise("readwrite",function(){return f(e)},!0);case"deleteRange":if(s.fire===Z)break;return i._promise("readwrite",function(){var n;return n=e,function e(n,i,a){return t.query({trans:n,values:!1,query:{index:r,range:i},limit:a}).then(function(t){var r=t.result;return f({type:"delete",keys:r,trans:n}).then(function(t){return t.numFailures>0?Promise.reject(t.failures[0]):r.length<a?{failures:[],numFailures:0,lastResult:void 0}:e(n,o(o({},i),{lower:r[r.length-1],lowerOpen:!0}),a)})})}(n.trans,n.range,1e4)},!0)}return t.mutate(e);function f(e){var n,i,u,f=ek.trans,h=e.keys||tg(r,e);if(!h)throw Error("Keys missing");return"delete"!==(e="add"===e.type||"put"===e.type?o(o({},e),{keys:h}):o({},e)).type&&(e.values=a([],e.values,!0)),e.keys&&(e.keys=a([],e.keys,!0)),(n=t,i=e,u=h,"add"===i.type?Promise.resolve([]):n.getMany({trans:i.trans,keys:u,cache:"immutable"})).then(function(n){var i=h.map(function(t,i){var o=n[i],a={onerror:null,onsuccess:null};if("delete"===e.type)s.fire.call(a,t,o,f);else if("add"===e.type||void 0===o){var u=c.fire.call(a,t,e.values[i],f);null!=t||null==u||(t=u,e.keys[i]=t,r.outbound||K(e.values[i],r.keyPath,t))}else{var h=tb(o,e.values[i]),p=l.fire.call(a,h,t,o,f);if(p){var y=e.values[i];Object.keys(p).forEach(function(e){d(y,e)?y[e]=p[e]:K(y,e,p[e])})}}return a});return t.mutate(e).then(function(t){for(var r=t.failures,o=t.results,a=t.numFailures,u=t.lastResult,s=0;s<h.length;++s){var c=o?o[s]:h[s],l=i[s];null==c?l.onerror&&l.onerror(r[s]):l.onsuccess&&l.onsuccess("put"===e.type&&n[s]?e.values[s]:c)}return{failures:r,results:o,numFailures:a,lastResult:u}}).catch(function(e){return i.forEach(function(n){return n.onerror&&n.onerror(e)}),Promise.reject(e)})})}}})}})}};function tw(e,n,t){try{if(!n||n.keys.length<e.length)return null;for(var r=[],i=0,o=0;i<n.keys.length&&o<e.length;++i)0===ns(n.keys[i],e[o])&&(r.push(t?A(n.values[i]):n.values[i]),++o);return r.length===e.length?r:null}catch(a){return null}}var t8={stack:"dbcore",level:-1,create:function(e){return{table:function(n){var t=e.table(n);return o(o({},t),{getMany:function(e){if(!e.cache)return t.getMany(e);var n=tw(e.keys,e.trans._cache,"clone"===e.cache);return n?eS.resolve(n):t.getMany(e).then(function(n){return e.trans._cache={keys:e.keys,values:"clone"===e.cache?A(n):n},n})},mutate:function(e){return"add"!==e.type&&(e.trans._cache=null),t.mutate(e)}})}}}};function t_(e,n){return"readonly"===e.trans.mode&&!!e.subscr&&!e.trans.explicit&&"disabled"!==e.trans.db._options.cache&&!n.schema.primaryKey.outbound}function tx(e,n){switch(e){case"query":return n.values&&!n.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var tk={stack:"dbcore",level:0,name:"Observability",create:function(e){var n=e.schema.name,t=new nZ(e.MIN_KEY,e.MAX_KEY);return o(o({},e),{transaction:function(n,t,r){if(ek.subscr&&"readonly"!==t)throw new X.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(ek.querier));return e.transaction(n,t,r)},table:function(r){var i=e.table(r),a=i.schema,u=a.primaryKey,l=a.indexes,f=u.extractKey,h=u.outbound,d=u.autoIncrement&&l.filter(function(e){return e.compound&&e.keyPath.includes(u.keyPath)}),p=o(o({},i),{mutate:function(o){var s,l,f=o.trans,h=o.mutatedParts||(o.mutatedParts={}),p=function(e){var t="idb://".concat(n,"/").concat(r,"/").concat(e);return h[t]||(h[t]=new nZ)},y=p(""),v=p(":dels"),m=o.type,b="deleteRange"===o.type?[o.range]:"delete"===o.type?[o.keys]:o.values.length<50?[tg(u,o).filter(function(e){return e}),o.values]:[],g=b[0],$=b[1],w=o.trans._cache;if(c(g)){y.addKeys(g);var _="delete"===m||g.length===$.length?tw(g,w):null;_||v.addKeys(g),(_||$)&&function e(n,t,r,i){t.indexes.forEach(function e(t){var o=n(t.name||"");function a(e){return null!=e?t.extractKey(e):null}var u=function(e){return t.multiEntry&&c(e)?e.forEach(function(e){return o.addKey(e)}):o.addKey(e)};(r||i).forEach(function(e,n){var t=r&&a(r[n]),o=i&&a(i[n]);0!==ns(t,o)&&(null!=t&&u(t),null!=o&&u(o))})})}(p,a,_,$)}else if(g){var x={from:null!==(s=g.lower)&&void 0!==s?s:e.MIN_KEY,to:null!==(l=g.upper)&&void 0!==l?l:e.MAX_KEY};v.add(x),y.add(x)}else y.add(t),v.add(t),a.indexes.forEach(function(e){return p(e.name).add(t)});return i.mutate(o).then(function(e){return g&&("add"===o.type||"put"===o.type)&&(y.addKeys(e.results),d&&d.forEach(function(n){for(var t=o.values.map(function(e){return n.extractKey(e)}),r=n.keyPath.findIndex(function(e){return e===u.keyPath}),i=0,a=e.results.length;i<a;++i)t[i][r]=e.results[i];p(n.name).addKeys(t)})),f.mutatedParts=ta(f.mutatedParts||{},h),e})}}),y=function(n){var t,r,i=n.query,o=i.index,a=i.range;return[o,new nZ(null!==(t=a.lower)&&void 0!==t?t:e.MIN_KEY,null!==(r=a.upper)&&void 0!==r?r:e.MAX_KEY),]},v={get:function(e){return[u,new nZ(e.key)]},getMany:function(e){return[u,new nZ().addKeys(e.keys)]},count:y,query:y,openCursor:y};return s(v).forEach(function(e){p[e]=function(a){var u=ek.subscr,s=t_(ek,i)&&tx(e,a)?a.obsSet={}:u;if(u){var c=function(e){var t="idb://".concat(n,"/").concat(r,"/").concat(e);return s[t]||(s[t]=new nZ)},l=c(""),d=c(":dels"),p=v[e](a),y=p[0],m=p[1];if("query"===e&&y.isPrimaryKey&&!a.values?d.add(m):c(y.name||"").add(m),!y.isPrimaryKey){if("count"===e)d.add(t);else{var b="query"===e&&h&&a.values&&i.query(o(o({},a),{values:!1}));return i[e].apply(this,arguments).then(function(n){if("query"===e){if(h&&a.values)return b.then(function(e){var t=e.result;return l.addKeys(t),n});var t=a.values?n.result.map(f):n.result;a.values?l.addKeys(t):d.addKeys(t)}else if("openCursor"===e){var r=n,i=a.values;return r&&Object.create(r,{key:{get:function(){return d.addKey(r.primaryKey),r.key}},primaryKey:{get:function(){var e=r.primaryKey;return d.addKey(e),e}},value:{get:function(){return i&&l.addKey(r.primaryKey),r.value}}})}return n})}}}return i[e].apply(this,arguments)}}),p}})}};function tK(e,n,t){if(0===t.numFailures)return n;if("deleteRange"===n.type)return null;var r=n.keys?n.keys.length:"values"in n&&n.values?n.values.length:1;if(t.numFailures===r)return null;var i=o({},n);return c(i.keys)&&(i.keys=i.keys.filter(function(e,n){return!(n in t.failures)})),"values"in i&&c(i.values)&&(i.values=i.values.filter(function(e,n){return!(n in t.failures)})),i}function tP(e,n){var t,r,i,o;return t=e,(void 0===(r=n).lower||(r.lowerOpen?ns(t,r.lower)>0:ns(t,r.lower)>=0))&&(i=e,void 0===(o=n).upper||(o.upperOpen?0>ns(i,o.upper):0>=ns(i,o.upper)))}function tO(e,n,t,r,i,o){if(!t||0===t.length)return e;var a=n.query.index,u=a.multiEntry,s=n.query.range,l=r.schema.primaryKey.extractKey,f=a.extractKey,h=(a.lowLevelIndex||a).extractKey,d=t.reduce(function(e,t){var r=e,i=[];if("add"===t.type||"put"===t.type)for(var o=new nZ,a=t.values.length-1;a>=0;--a){var h=t.values[a],d=l(h);if(!o.hasKey(d)){var p=f(h);(u&&c(p)?p.some(function(e){return tP(e,s)}):tP(p,s))&&(o.addKey(d),i.push(h))}}switch(t.type){case"add":var y=new nZ().addKeys(n.values?e.map(function(e){return l(e)}):e);r=e.concat(n.values?i.filter(function(e){var n=l(e);return!y.hasKey(n)&&(y.addKey(n),!0)}):i.map(function(e){return l(e)}).filter(function(e){return!y.hasKey(e)&&(y.addKey(e),!0)}));break;case"put":var v=new nZ().addKeys(t.values.map(function(e){return l(e)}));r=e.filter(function(e){return!v.hasKey(n.values?l(e):e)}).concat(n.values?i:i.map(function(e){return l(e)}));break;case"delete":var m=new nZ().addKeys(t.keys);r=e.filter(function(e){return!m.hasKey(n.values?l(e):e)});break;case"deleteRange":var b=t.range;r=e.filter(function(e){return!tP(l(e),b)})}return r},e);return d===e?e:(d.sort(function(e,n){return ns(h(e),h(n))||ns(l(e),l(n))}),n.limit&&n.limit<1/0&&(d.length>n.limit?d.length=n.limit:e.length===n.limit&&d.length<n.limit&&(i.dirty=!0)),o?Object.freeze(d):d)}function tS(e,n){return 0===ns(e.lower,n.lower)&&0===ns(e.upper,n.upper)&&!!e.lowerOpen==!!n.lowerOpen&&!!e.upperOpen==!!n.upperOpen}var tC={stack:"dbcore",level:0,name:"Cache",create:function(e){var n=e.schema.name;return o(o({},e),{transaction:function(t,r,i){var o=e.transaction(t,r,i);if("readwrite"===r){var a=new AbortController,u=a.signal,s=function(i){return function(){if(a.abort(),"readwrite"===r){for(var u=new Set,s=0,c=t;s<c.length;s++){var l=c[s],f=ts["idb://".concat(n,"/").concat(l)];if(f){var h=e.table(l),d=f.optimisticOps.filter(function(e){return e.trans===o});if(o._explicit&&i&&o.mutatedParts)for(var p=0,y=Object.values(f.queries.query);p<y.length;p++)for(var v=y[p],m=0,b=v.slice();m<b.length;m++){var g=b[m];tu(g.obsSet,o.mutatedParts)&&(j(v,g),g.subscribers.forEach(function(e){return u.add(e)}))}else if(d.length>0){f.optimisticOps=f.optimisticOps.filter(function(e){return e.trans!==o});for(var $=0,w=Object.values(f.queries.query);$<w.length;$++)for(var v=w[$],_=0,x=v.slice();_<x.length;_++){var g=x[_];if(null!=g.res&&o.mutatedParts){if(i&&!g.dirty){var k=Object.isFrozen(g.res),K=tO(g.res,g.req,d,h,g,k);g.dirty?(j(v,g),g.subscribers.forEach(function(e){return u.add(e)})):K!==g.res&&(g.res=K,g.promise=eS.resolve({result:K}))}else g.dirty&&j(v,g),g.subscribers.forEach(function(e){return u.add(e)})}}}}}u.forEach(function(e){return e()})}}};o.addEventListener("abort",s(!1),{signal:u}),o.addEventListener("error",s(!1),{signal:u}),o.addEventListener("complete",s(!0),{signal:u})}return o},table:function(t){var r=e.table(t),i=r.schema.primaryKey;return o(o({},r),{mutate:function(e){var a=ek.trans;if(i.outbound||"disabled"===a.db._options.cache||a.explicit||"readwrite"!==a.idbtrans.mode)return r.mutate(e);var u=ts["idb://".concat(n,"/").concat(t)];if(!u)return r.mutate(e);var s=r.mutate(e);return("add"===e.type||"put"===e.type)&&(e.values.length>=50||tg(i,e).some(function(e){return null==e}))?s.then(function(n){var t=o(o({},e),{values:e.values.map(function(e,t){if(n.failures[t])return e;var r,a=(null===(r=i.keyPath)||void 0===r?void 0:r.includes("."))?A(e):o({},e);return K(a,i.keyPath,n.results[t]),a})}),r=tK(u,t,n);u.optimisticOps.push(r),queueMicrotask(function(){return e.mutatedParts&&tf(e.mutatedParts)})}):(u.optimisticOps.push(e),e.mutatedParts&&tf(e.mutatedParts),s.then(function(n){if(n.numFailures>0){j(u.optimisticOps,e);var t=tK(u,e,n);t&&u.optimisticOps.push(t),e.mutatedParts&&tf(e.mutatedParts)}}),s.catch(function(){j(u.optimisticOps,e),e.mutatedParts&&tf(e.mutatedParts)})),s},query:function(e){if(!t_(ek,r)||!tx("query",e))return r.query(e);var i,o,a,u,s,c=(null===(s=ek.trans)||void 0===s?void 0:s.db._options.cache)==="immutable",l=ek,f=l.requery,h=l.signal,d=function e(n,t,r,i){var o=ts["idb://".concat(n,"/").concat(t)];if(!o)return[];var a=o.queries[r];if(!a)return[null,!1,o,null];var u=a[(i.query?i.query.index.name:null)||""];if(!u)return[null,!1,o,null];switch(r){case"query":var s=u.find(function(e){return e.req.limit===i.limit&&e.req.values===i.values&&tS(e.req.query.range,i.query.range)});if(s)return[s,!0,o,u,];return[u.find(function(e){var n,t;return("limit"in e.req?e.req.limit:1/0)>=i.limit&&(!i.values||e.req.values)&&(n=e.req.query.range,t=i.query.range,0>=function e(n,t,r,i){if(void 0===n)return void 0!==t?-1:0;if(void 0===t)return 1;var o=ns(n,t);if(0===o){if(r&&i)return 0;if(r)return 1;if(i)return -1}return o}(n.lower,t.lower,n.lowerOpen,t.lowerOpen)&&function e(n,t,r,i){if(void 0===n)return void 0!==t?1:0;if(void 0===t)return -1;var o=ns(n,t);if(0===o){if(r&&i)return 0;if(r)return -1;if(i)return 1}return o}(n.upper,t.upper,n.upperOpen,t.upperOpen)>=0)}),!1,o,u];case"count":var c=u.find(function(e){return tS(e.req.query.range,i.query.range)});return[c,!!c,o,u]}}(n,t,"query",e),p=d[0],y=d[1],v=d[2],m=d[3];if(p&&y)p.obsSet=e.obsSet;else{var b=r.query(e).then(function(e){var n=e.result;if(p&&(p.res=n),c){for(var t=0,r=n.length;t<r;++t)Object.freeze(n[t]);Object.freeze(n)}else e.result=A(n);return e}).catch(function(e){return m&&p&&j(m,p),Promise.reject(e)});p={obsSet:e.obsSet,promise:b,subscribers:new Set,type:"query",req:e,dirty:!1},m?m.push(p):(m=[p],v||(v=ts["idb://".concat(n,"/").concat(t)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}}),v.queries.query[e.query.index.name||""]=m)}return i=p,o=m,a=f,u=h,i.subscribers.add(a),u.addEventListener("abort",function(){var e,n;i.subscribers.delete(a),0===i.subscribers.size&&(e=i,n=o,setTimeout(function(){0===e.subscribers.size&&j(n,e)},3e3))}),p.promise.then(function(n){return{result:tO(n.result,e,null==v?void 0:v.optimisticOps,r,p,c)}})}})}})}};function tE(e,n){return new Proxy(e,{get:function(e,t,r){return"db"===t?n:Reflect.get(e,t,r)}})}var tD=function(){function e(n,t){var r=this;this._middlewares={},this.verno=0;var i=e.dependencies;this._options=t=o({addons:e.addons,autoOpen:!0,indexedDB:i.indexedDB,IDBKeyRange:i.IDBKeyRange,cache:"cloned"},t),this._deps={indexedDB:t.indexedDB,IDBKeyRange:t.IDBKeyRange};var a=t.addons;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var u,s,c,l,f,h,d,p={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:Z,dbReadyPromise:null,cancelOpen:Z,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:t.autoOpen};p.dbReadyPromise=new eS(function(e){p.dbReadyResolve=e}),p.openCanceller=new eS(function(e,n){p.cancelOpen=n}),this._state=p,this.name=n,this.on=nh(this,"populate","blocked","versionchange","close",{ready:[eu,Z]}),this.on.ready.subscribe=(u=this.on.ready.subscribe,(s=function(n){return function(t,i){e.vip(function(){var e=r._state;if(e.openComplete)e.dbOpenError||eS.resolve().then(t),i&&n(t);else if(e.onReadyBeingFired)e.onReadyBeingFired.push(t),i&&n(t);else{n(t);var o=r;i||n(function e(){o.on.ready.unsubscribe(t),o.on.ready.unsubscribe(e)})}})}})(u)),this.Collection=(c=this,nd(n8.prototype,function e(n,t){this.db=c;var r=no,i=null;if(t)try{r=t()}catch(o){i=o}var a=n._ctx,u=a.table,s=u.hook.reading.fire;this._ctx={table:u,index:a.index,isPrimKey:!a.index||u.schema.primKey.keyPath&&a.index===u.schema.primKey.name,range:r,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:i,or:a.or,valueMapper:s!==ee?s:null}})),this.Table=(l=this,nd(nf.prototype,function e(n,t,r){this.db=l,this._tx=r,this.name=n,this.schema=t,this.hook=l._allTables[n]?l._allTables[n].hook:nh(null,{creating:[er,Z],reading:[en,ee],updating:[eo,Z],deleting:[ei,Z]})})),this.Transaction=(f=this,nd(nj.prototype,function e(n,t,r,i,o){var a=this;this.db=f,this.mode=n,this.storeNames=t,this.schema=r,this.chromeTransactionDurability=i,this.idbtrans=null,this.on=nh(this,"complete","error","abort"),this.parent=o||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new eS(function(e,n){a._resolve=e,a._reject=n}),this._completion.then(function(){a.active=!1,a.on.complete.fire()},function(e){var n=a.active;return a.active=!1,a.on.error.fire(e),a.parent?a.parent._reject(e):n&&a.idbtrans&&a.idbtrans.abort(),e7(e)})})),this.Version=(h=this,nd(nH.prototype,function e(n){this.db=h,this._cfg={version:n,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(d=this,nd(nD.prototype,function e(n,t,r){if(this.db=d,this._ctx={table:n,index:":id"===t?null:t,or:r},this._cmp=this._ascending=ns,this._descending=function(e,n){return ns(n,e)},this._max=function(e,n){return ns(e,n)>0?e:n},this._min=function(e,n){return 0>ns(e,n)?e:n},this._IDBKeyRange=d._deps.IDBKeyRange,!this._IDBKeyRange)throw new X.MissingAPI})),this.on("versionchange",function(e){e.newVersion>0?console.warn("Another connection wants to upgrade database '".concat(r.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(r.name,"'. Closing db now to resume the delete request.")),r.close({disableAutoOpen:!1})}),this.on("blocked",function(e){!e.newVersion||e.newVersion<e.oldVersion?console.warn("Dexie.delete('".concat(r.name,"') was blocked")):console.warn("Upgrade '".concat(r.name,"' blocked by other connection holding version ").concat(e.oldVersion/10))}),this._maxKey=nM(t.IDBKeyRange),this._createTransaction=function(e,n,t,i){return new r.Transaction(e,n,t,r._options.chromeTransactionDurability,i)},this._fireOnBlocked=function(e){r.on("blocked").fire(e),ne.filter(function(e){return e.name===r.name&&e!==r&&!e._state.vcFired}).map(function(n){return n.on("versionchange").fire(e)})},this.use(t8),this.use(tC),this.use(tk),this.use(tm),this.use(t$);var y=new Proxy(this,{get:function(e,n,t){if("_vip"===n)return!0;if("table"===n)return function(e){return tE(r.table(e),y)};var i=Reflect.get(e,n,t);return i instanceof nf?tE(i,y):"tables"===n?i.map(function(e){return tE(e,y)}):"_createTransaction"===n?function(){var e=i.apply(this,arguments);return tE(e,y)}:i}});this.vip=y,a.forEach(function(e){return e(r)})}return e.prototype.version=function(e){if(isNaN(e)||e<.1)throw new X.Type("Given version is not a positive number");if(e=Math.round(10*e)/10,this.idbdb||this._state.isBeingOpened)throw new X.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);var n=this._versions,t=n.filter(function(n){return n._cfg.version===e})[0];return t||(t=new this.Version(e),n.push(t),n.sort(nW),t.stores({}),this._state.autoSchema=!1),t},e.prototype._whenReady=function(e){var n=this;return this.idbdb&&(this._state.openComplete||ek.letThrough||this._vip)?e():new eS(function(e,t){if(n._state.openComplete)return t(new X.DatabaseClosed(n._state.dbOpenError));if(!n._state.isBeingOpened){if(!n._state.autoOpen){t(new X.DatabaseClosed);return}n.open().catch(Z)}n._state.dbReadyPromise.then(e,t)}).then(e)},e.prototype.use=function(e){var n=e.stack,t=e.create,r=e.level,i=e.name;i&&this.unuse({stack:n,name:i});var o=this._middlewares[n]||(this._middlewares[n]=[]);return o.push({stack:n,create:t,level:null==r?10:r,name:i}),o.sort(function(e,n){return e.level-n.level}),this},e.prototype.unuse=function(e){var n=e.stack,t=e.name,r=e.create;return n&&this._middlewares[n]&&(this._middlewares[n]=this._middlewares[n].filter(function(e){return r?e.create!==r:!!t&&e.name!==t})),this},e.prototype.open=function(){var e=this;return e4(ex,function(){return function e(n){var t=n._state,r=n._deps.indexedDB;if(t.isBeingOpened||n.idbdb)return t.dbReadyPromise.then(function(){return t.dbOpenError?e7(t.dbOpenError):n});t.isBeingOpened=!0,t.dbOpenError=null,t.openComplete=!1;var i=t.openCanceller,o=Math.round(10*n.verno),a=!1;function u(){if(t.openCanceller!==i)throw new X.DatabaseClosed("db.open() was cancelled")}var c,l=t.dbReadyResolve,f=null,h=!1,d=function(){return new eS(function(e,i){if(u(),!r)throw new X.MissingAPI;var c=n.name,l=t.autoSchema||!o?r.open(c):r.open(c,o);if(!l)throw new X.MissingAPI;l.onerror=nA(i),l.onblocked=eN(n._fireOnBlocked),l.onupgradeneeded=eN(function(e){if(f=l.transaction,t.autoSchema&&!n._options.allowEmptyDB){l.onerror=nq,f.abort(),l.result.close();var o=r.deleteDatabase(c);o.onsuccess=o.onerror=eN(function(){i(new X.NoSuchDatabase("Database ".concat(c," doesnt exist")))})}else{f.onerror=nA(i);var u,d,p,y,v,m,b,g,$=e.oldVersion>0x4000000000000000?0:e.oldVersion;h=$<1,n.idbdb=l.result,a&&function e(n,t){nQ(n._dbSchema,t),t.db.version%10!=0||t.objectStoreNames.contains("$meta")||t.db.createObjectStore("$meta").add(Math.ceil(t.db.version/10-1),"version");var r=n2(n,n.idbdb,t);n4(n,n._dbSchema,t);for(var i=n9(r,n._dbSchema),o=function(e){if(e.change.length||e.recreate)return console.warn("Unable to patch indexes of table ".concat(e.name," because it has changes on the type of index or primary key.")),{value:void 0};var n=t.objectStore(e.name);e.add.forEach(function(t){es&&console.debug("Dexie upgrade patch: Creating missing index ".concat(e.name,".").concat(t.src)),nG(n,t)})},a=0,u=i.change;a<u.length;a++){var s=o(u[a]);if("object"==typeof s)return s.value}}(n,f),u=n,d=$/10,p=f,y=i,v=u._dbSchema,p.objectStoreNames.contains("$meta")&&!v.$meta&&(v.$meta=nN("$meta",nX("")[0],[]),u._storeNames.push("$meta")),(m=u._createTransaction("readwrite",u._storeNames,v)).create(p),m._completion.catch(y),b=m._reject.bind(m),g=ek.transless||ek,e1(function(){if(ek.trans=m,ek.transless=g,0!==d){var e,n,t;return n0(u,p),(e=u,n=m,t=d,n.storeNames.includes("$meta")?n.table("$meta").get("version").then(function(e){return null!=e?e:t}):eS.resolve(t)).then(function(e){var n,t,r,i,o,a,c,l;return n=u,t=e,r=m,i=p,o=[],a=n._versions,c=n._dbSchema=n2(n,n.idbdb,i),l=a.filter(function(e){return e._cfg.version>=t}),0===l.length?eS.resolve():(l.forEach(function(e){o.push(function(){var o=c,a=e._cfg.dbschema;n4(n,o,i),n4(n,a,i),c=n._dbSchema=a;var u=n9(o,a);u.add.forEach(function(e){n6(i,e[0],e[1].primKey,e[1].indexes)}),u.change.forEach(function(e){if(e.recreate)throw new X.Upgrade("Not yet support for changing primary key");var n=i.objectStore(e.name);e.add.forEach(function(e){return nG(n,e)}),e.change.forEach(function(e){n.deleteIndex(e.name),nG(n,e)}),e.del.forEach(function(e){return n.deleteIndex(e)})});var l=e._cfg.contentUpgrade;if(l&&e._cfg.version>t){n0(n,i),r._memoizedTables={};var f,h=P(a);u.del.forEach(function(e){h[e]=o[e]}),nY(n,[n.Transaction.prototype]),n1(n,[n.Transaction.prototype],s(h),h),r.schema=h;var d=N(l);d&&eY();var p=eS.follow(function(){if((f=l(r))&&d){var e=eW.bind(null,null);f.then(e,e)}});return f&&"function"==typeof f.then?eS.resolve(f):p.then(function(){return f})}}),o.push(function(t){(function e(n,t){[].slice.call(t.db.objectStoreNames).forEach(function(e){return null==n[e]&&t.db.deleteObjectStore(e)})})(e._cfg.dbschema,t),nY(n,[n.Transaction.prototype]),n1(n,[n.Transaction.prototype],n._storeNames,n._dbSchema),r.schema=n._dbSchema}),o.push(function(t){n.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(n.idbdb.version/10)===e._cfg.version?(n.idbdb.deleteObjectStore("$meta"),delete n._dbSchema.$meta,n._storeNames=n._storeNames.filter(function(e){return"$meta"!==e})):t.objectStore("$meta").put(e._cfg.version,"version"))})}),(function e(){return o.length?eS.resolve(o.shift()(r.idbtrans)).then(e):eS.resolve()})().then(function(){nQ(c,i)}))}).catch(b)}s(v).forEach(function(e){n6(p,e,v[e].primKey,v[e].indexes)}),n0(u,p),eS.follow(function(){return u.on.populate.fire(m)}).catch(b)})}},i),l.onsuccess=eN(function(){f=null;var r,i,u,p,y=n.idbdb=l.result,v=$(y.objectStoreNames);if(v.length>0)try{var m,b,g,w,_,x,k,K,P,O=y.transaction((P=v,1===P.length?P[0]:P),"readonly");if(t.autoSchema)m=n,b=y,g=O,m.verno=b.version/10,w=m._dbSchema=n2(m,b,g),m._storeNames=$(b.objectStoreNames,0),n1(m,[m._allTables],s(w),w);else if(n4(n,n._dbSchema,O),_=n,x=O,k=n2(_,_.idbdb,x),((K=n9(k,_._dbSchema)).add.length||K.change.some(function(e){return e.add.length||e.change.length}))&&!a)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),y.close(),o=y.version+1,a=!0,e(d());n0(n,O)}catch(S){}ne.push(n),y.onversionchange=eN(function(e){t.vcFired=!0,n.on("versionchange").fire(e)}),y.onclose=eN(function(e){n.on("close").fire(e)}),h&&(r=n._deps,i=c,u=r.indexedDB,p=r.IDBKeyRange,n3(u)||i===nn||n7(u,p).put({name:i}).catch(Z)),e()},i)}).catch(function(e){switch(null==e?void 0:e.name){case"UnknownError":if(t.PR1398_maxLoop>0)return t.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),d();break;case"VersionError":if(o>0)return o=0,d()}return eS.reject(e)})};return eS.race([i,("undefined"==typeof navigator?eS.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(e){var n=function(){return indexedDB.databases().finally(e)};c=setInterval(n,100),n()}).finally(function(){return clearInterval(c)}):Promise.resolve()).then(d)]).then(function(){return u(),t.onReadyBeingFired=[],eS.resolve(n5(function(){return n.on.ready.fire(n.vip)})).then(function e(){if(t.onReadyBeingFired.length>0){var r=t.onReadyBeingFired.reduce(eu,Z);return t.onReadyBeingFired=[],eS.resolve(n5(function(){return r(n.vip)})).then(e)}})}).finally(function(){t.openCanceller===i&&(t.onReadyBeingFired=null,t.isBeingOpened=!1)}).catch(function(e){t.dbOpenError=e;try{f&&f.abort()}catch(r){}return i===t.openCanceller&&n._close(),e7(e)}).finally(function(){t.openComplete=!0,l()}).then(function(){if(h){var e={};n.tables.forEach(function(t){t.schema.indexes.forEach(function(r){r.name&&(e["idb://".concat(n.name,"/").concat(t.name,"/").concat(r.name)]=new nZ(-1/0,[[[]]]))}),e["idb://".concat(n.name,"/").concat(t.name,"/")]=e["idb://".concat(n.name,"/").concat(t.name,"/:dels")]=new nZ(-1/0,[[[]]])}),nR(nI).fire(e),th(e,!0)}return n})}(e)})},e.prototype._close=function(){var e=this._state,n=ne.indexOf(this);if(n>=0&&ne.splice(n,1),this.idbdb){try{this.idbdb.close()}catch(t){}this.idbdb=null}e.isBeingOpened||(e.dbReadyPromise=new eS(function(n){e.dbReadyResolve=n}),e.openCanceller=new eS(function(n,t){e.cancelOpen=t}))},e.prototype.close=function(e){var n=(void 0===e?{disableAutoOpen:!0}:e).disableAutoOpen,t=this._state;n?(t.isBeingOpened&&t.cancelOpen(new X.DatabaseClosed),this._close(),t.autoOpen=!1,t.dbOpenError=new X.DatabaseClosed):(this._close(),t.autoOpen=this._options.autoOpen||t.isBeingOpened,t.openComplete=!1,t.dbOpenError=null)},e.prototype.delete=function(e){var n=this;void 0===e&&(e={disableAutoOpen:!0});var t=arguments.length>0&&"object"!=typeof arguments[0],r=this._state;return new eS(function(i,o){var a=function(){n.close(e);var t=n._deps.indexedDB.deleteDatabase(n.name);t.onsuccess=eN(function(){var e,t,r,o;e=n._deps,t=n.name,r=e.indexedDB,o=e.IDBKeyRange,n3(r)||t===nn||n7(r,o).delete(t).catch(Z),i()}),t.onerror=nA(o),t.onblocked=n._fireOnBlocked};if(t)throw new X.InvalidArgument("Invalid closeOptions argument to db.delete()");r.isBeingOpened?r.dbReadyPromise.then(a):a()})},e.prototype.backendDB=function(){return this.idbdb},e.prototype.isOpen=function(){return null!==this.idbdb},e.prototype.hasBeenClosed=function(){var e=this._state.dbOpenError;return e&&"DatabaseClosed"===e.name},e.prototype.hasFailed=function(){return null!==this._state.dbOpenError},e.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(e.prototype,"tables",{get:function(){var e=this;return s(this._allTables).map(function(n){return e._allTables[n]})},enumerable:!1,configurable:!0}),e.prototype.transaction=function(){var e=ty.apply(this,arguments);return this._transaction.apply(this,e)},e.prototype._transaction=function(e,n,t){var r,i,o=this,a=ek.trans;a&&a.db===this&&-1===e.indexOf("!")||(a=null);var u=-1!==e.indexOf("?");e=e.replace("!","").replace("?","");try{if(i=n.map(function(e){var n=e instanceof o.Table?e.name:e;if("string"!=typeof n)throw TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return n}),"r"==e||e===nt)r=nt;else if("rw"==e||e==nr)r=nr;else throw new X.InvalidArgument("Invalid transaction mode: "+e);if(a){if(a.mode===nt&&r===nr){if(u)a=null;else throw new X.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY")}a&&i.forEach(function(e){if(a&&-1===a.storeNames.indexOf(e)){if(u)a=null;else throw new X.SubTransaction("Table "+e+" not included in parent transaction.")}}),u&&a&&!a.active&&(a=null)}}catch(s){return a?a._promise(null,function(e,n){n(s)}):e7(s)}var c=(function e(n,t,r,i,o){return eS.resolve().then(function(){var a,u=ek.transless||ek,s=n._createTransaction(t,r,n._dbSchema,i);if(s.explicit=!0,i)s.idbtrans=i.idbtrans;else try{s.create(),s.idbtrans._explicit=!0,n._state.PR1398_maxLoop=3}catch(c){if(c.name===Q.InvalidState&&n.isOpen()&&--n._state.PR1398_maxLoop>0)return console.warn("Dexie: Need to reopen db"),n.close({disableAutoOpen:!1}),n.open().then(function(){return e(n,t,r,null,o)});return e7(c)}var l=N(o);l&&eY();var f=eS.follow(function(){if(a=o.call(s,s)){if(l){var e=eW.bind(null,null);a.then(e,e)}else"function"==typeof a.next&&"function"==typeof a.throw&&(a=tp(a))}},{trans:s,transless:u});return(a&&"function"==typeof a.then?eS.resolve(a).then(function(e){return s.active?e:e7(new X.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):f.then(function(){return a})).then(function(e){return i&&s._resolve(),s._completion.then(function(){return e})}).catch(function(e){return s._reject(e),e7(e)})})}).bind(null,this,r,i,a,t);return a?a._promise(r,c,"lock"):ek.trans?e4(ek.transless,function(){return o._whenReady(c)}):this._whenReady(c)},e.prototype.table=function(e){if(!d(this._allTables,e))throw new X.InvalidTable("Table ".concat(e," does not exist"));return this._allTables[e]},e}(),tA="undefined"!=typeof Symbol&&"observable"in Symbol?Symbol.observable:"@@observable",tq=function(){function e(e){this._subscribe=e}return e.prototype.subscribe=function(e,n,t){return this._subscribe(e&&"function"!=typeof e?e:{next:e,error:n,complete:t})},e.prototype[tA]=function(){return this},e}();try{t={indexedDB:u.indexedDB||u.mozIndexedDB||u.webkitIndexedDB||u.msIndexedDB,IDBKeyRange:u.IDBKeyRange||u.webkitIDBKeyRange}}catch(tI){t={indexedDB:null,IDBKeyRange:null}}function tB(e){var n,r=!1,i=new tq(function(i){var o,a=N(e),u=!1,s={},c={},l={get closed(){return u},unsubscribe:function(){!u&&(u=!0,o&&o.abort(),f&&nR.storagemutated.unsubscribe(p))}};i.start&&i.start(l);var f=!1,h=function(){return eH(y)},p=function(e){ta(s,e),tu(c,s)&&h()},y=function(){if(!u&&t.indexedDB){s={};var l={};o&&o.abort(),o=new AbortController;var y={subscr:l,signal:o.signal,requery:h,querier:e,trans:null};Promise.resolve(function n(t){var r=eR();try{a&&eY();var i=e1(e,t);return a&&(i=i.finally(eW)),i}finally{r&&ej()}}(y)).then(function(e){r=!0,n=e,!u&&!y.signal.aborted&&(s={},function e(n){for(var t in n)if(d(n,t))return!1;return!0}(c=l)||f||(nR(nI,p),f=!0),eH(function(){return!u&&i.next&&i.next(e)}))},function(e){r=!1,["DatabaseClosedError","AbortError"].includes(null==e?void 0:e.name)||u||eH(function(){!u&&i.error&&i.error(e)})})}};return setTimeout(h,0),l});return i.hasValue=function(){return r},i.getValue=function(){return n},i}var tR=tD;function tj(e){var n=tT;try{tT=!0,nR.storagemutated.fire(e),th(e,!0)}finally{tT=n}}p(tR,o(o({},J),{delete:function(e){return new tR(e,{addons:[]}).delete()},exists:function(e){return new tR(e,{addons:[]}).open().then(function(e){return e.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(e){try{var n,t,r;return(t=(n=tR.dependencies).indexedDB,r=n.IDBKeyRange,n3(t)?Promise.resolve(t.databases()).then(function(e){return e.map(function(e){return e.name}).filter(function(e){return e!==nn})}):n7(t,r).toCollection().primaryKeys()).then(e)}catch(i){return e7(new X.MissingAPI)}},defineClass:function(){return function e(n){l(this,n)}},ignoreTransaction:function(e){return ek.trans?e4(ek.transless,e):e()},vip:n5,async:function(e){return function(){try{var n=tp(e.apply(this,arguments));if(!n||"function"!=typeof n.then)return eS.resolve(n);return n}catch(t){return e7(t)}}},spawn:function(e,n,t){try{var r=tp(e.apply(t,n||[]));if(!r||"function"!=typeof r.then)return eS.resolve(r);return r}catch(i){return e7(i)}},currentTransaction:{get:function(){return ek.trans||null}},waitFor:function(e,n){var t=eS.resolve("function"==typeof e?tR.ignoreTransaction(e):e).timeout(n||6e4);return ek.trans?ek.trans.waitFor(t):t},Promise:eS,debug:{get:function(){return es},set:function(e){var n;es=n=e}},derive:m,extend:l,props:p,override:w,Events:nh,on:nR,liveQuery:tB,extendObservabilitySet:ta,getByKeyPath:k,setByKeyPath:K,delByKeyPath:function e(n,t){"string"==typeof t?K(n,t,void 0):"length"in t&&[].map.call(t,function(e){K(n,e,void 0)})},shallowClone:P,deepClone:A,getObjectDiff:tb,cmp:ns,asap:x,minKey:e5,addons:[],connections:ne,errnames:Q,dependencies:t,cache:ts,semVer:e3,version:e3.split(".").map(function(e){return parseInt(e)}).reduce(function(e,n,t){return e+n/Math.pow(10,2*t)})})),tR.maxKey=nM(tR.dependencies.IDBKeyRange),"undefined"!=typeof dispatchEvent&&"undefined"!=typeof addEventListener&&(nR(nI,function(e){if(!tT){var n;n=new CustomEvent(nB,{detail:e}),tT=!0,dispatchEvent(n),tT=!1}}),addEventListener(nB,function(e){var n=e.detail;tT||tj(n)}));var tT=!1,tF=function(){};"undefined"!=typeof BroadcastChannel&&((tF=function(){(r=new BroadcastChannel(nB)).onmessage=function(e){return e.data&&tj(e.data)}})(),"function"==typeof r.unref&&r.unref(),nR(nI,function(e){tT||r.postMessage(e)})),"undefined"!=typeof addEventListener&&(addEventListener("pagehide",function(e){if(!tD.disableBfCache&&e.persisted){es&&console.debug("Dexie: handling persisted pagehide"),null==r||r.close();for(var n=0,t=ne;n<t.length;n++)t[n].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(e){!tD.disableBfCache&&e.persisted&&(es&&console.debug("Dexie: handling persisted pageshow"),tF(),tj({all:new nZ(-1/0,[[]])}))})),eS.rejectionMapper=function e(n,t){if(!n||n instanceof V||n instanceof TypeError||n instanceof SyntaxError||!n.name||!H[n.name])return n;var r=new H[n.name](t||n.message,n);return"stack"in n&&v(r,"stack",{get:function(){return this.inner.stack}}),r},es=e=es;var tN=Object.freeze({__proto__:null,Dexie:tD,liveQuery:tB,Entity:nu,cmp:ns,PropModification:nw,replacePrefix:function e(n,t){return new nw({replacePrefix:[n,t]})},add:function e(n){return new nw({add:n})},remove:function e(n){return new nw({remove:n})},default:tD,RangeSet:nZ,mergeRanges:tn,rangesOverlap:tt});return o(tD,tN,{default:tD}),tD});
